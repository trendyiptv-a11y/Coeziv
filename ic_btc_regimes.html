<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Regimuri bull / bear – model coeziv BTC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Luxon + Chart.js + adapter -->
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>

  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-card: #020617;
      --bg-card-soft: #020617;
      --fg: #e5e7eb;
      --fg-muted: #9ca3af;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.15);
      --bull: #22c55e;
      --bear: #f97373;
      --border-soft: rgba(148,163,184,0.3);
      --shadow-soft: 0 18px 40px rgba(15,23,42,0.9);
      --radius-xl: 22px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
      background: radial-gradient(circle at 10% 0%, #0f172a 0, #020617 40%, #000 100%);
      color: var(--fg);
      padding: 16px;
    }

    .shell {
      max-width: 1080px;
      margin: 0 auto 80px auto;
    }

    h1 {
      font-size: 1.6rem;
      letter-spacing: 0.02em;
      margin: 0;
    }

    .subtitle {
      margin-top: 10px;
      color: var(--fg-muted);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.35), transparent 55%);
      font-size: 0.8rem;
      color: #e5f3ff;
      margin-top: 14px;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #4ade80;
      box-shadow: 0 0 12px rgba(74,222,128,0.65);
    }

    .section-card {
      position: relative;
      margin-top: 20px;
      padding: 18px 16px 18px 16px;
      border-radius: var(--radius-xl);
      border: 1px solid rgba(148,163,184,0.35);
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.12), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(126,34,206,0.12), transparent 55%),
        linear-gradient(145deg, rgba(15,23,42,0.98), #020617);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(18px);
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .section-subtitle {
      font-size: 0.9rem;
      color: var(--fg-muted);
      margin-bottom: 12px;
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .chip {
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      color: var(--fg-muted);
      background: rgba(15,23,42,0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip-bullet {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148,163,184,0.9);
    }

    .back-row {
      margin-top: 18px;
      display: flex;
      justify-content: flex-start;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.96);
      color: var(--fg);
      font-size: 0.83rem;
      cursor: pointer;
      text-decoration: none;
    }

    .back-btn span.icon {
      font-size: 0.8rem;
      translate: 0 0.5px;
    }

    .grid-two {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 14px;
    }

    .metric-card {
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.4);
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.08), transparent 55%),
                  rgba(15,23,42,0.98);
      padding: 12px 12px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .metric-label {
      font-size: 0.77rem;
      color: var(--fg-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .metric-value-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .metric-value {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .metric-pill {
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.98);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .metric-pill.bull {
      border-color: rgba(34,197,94,0.6);
      color: #bbf7d0;
      background: radial-gradient(circle at 0 0, rgba(34,197,94,0.25), transparent 55%);
    }

    .metric-pill.bear {
      border-color: rgba(248,113,113,0.6);
      color: #fecaca;
      background: radial-gradient(circle at 0 0, rgba(248,113,113,0.25), transparent 55%);
    }

    .metric-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .metric-dot.bull {
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34,197,94,0.7);
    }

    .metric-dot.bear {
      background: #f97373;
      box-shadow: 0 0 12px rgba(248,113,113,0.7);
    }

    .chart-card {
      margin-top: 18px;
      padding: 14px 10px 14px 10px;
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.4);
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.08), transparent 55%),
                  radial-gradient(circle at 100% 0, rgba(168,85,247,0.08), transparent 55%),
                  rgba(15,23,42,0.98);
    }

    .chart-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .chart-title {
      font-size: 0.94rem;
      font-weight: 500;
    }

    .legend-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      font-size: 0.78rem;
      color: var(--fg-muted);
    }

    .legend-row {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .legend-swatch {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 2px solid transparent;
    }

    .legend-swatch.struct {
      border-color: rgba(56,189,248,1);
    }

    .legend-swatch.dir {
      border-color: rgba(248,113,113,1);
    }

    .legend-label {
      white-space: nowrap;
    }

    canvas {
      width: 100%;
      max-height: 420px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 14px;
      font-size: 0.8rem;
    }

    thead {
      background: rgba(15,23,42,0.98);
    }

    th, td {
      padding: 8px 9px;
      border-bottom: 1px solid rgba(51,65,85,0.9);
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--fg-muted);
    }

    tbody tr:nth-child(even) {
      background: rgba(15,23,42,0.7);
    }

    .regime-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 4px 9px;
      font-size: 0.75rem;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.9);
    }

    .regime-badge.bull {
      border-color: rgba(34,197,94,0.6);
      color: #bbf7d0;
    }

    .regime-badge.bear {
      border-color: rgba(248,113,113,0.6);
      color: #fecaca;
    }

    .regime-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .regime-dot.bull {
      background: var(--bull);
    }

    .regime-dot.bear {
      background: var(--bear);
    }

    .note {
      margin-top: 14px;
      font-size: 0.77rem;
      color: var(--fg-muted);
      line-height: 1.5;
    }

    .note strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .note code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.75rem;
      background: rgba(15,23,42,0.9);
      padding: 1px 4px;
      border-radius: 4px;
    }

    @media (min-width: 900px) {
      body {
        padding-top: 28px;
      }
      h1 {
        font-size: 1.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- Header -->
    <div>
      <h1>Regimuri bull / bear – model coeziv BTC</h1>
      <p class="subtitle">
        Perioade estimate de <strong>bull market</strong> și <strong>bear market</strong> pe baza indicilor
        coezivi <code>IC_BTC structural</code> și <code>ICD_BTC direcțional</code>, calculați din date zilnice
        BTCUSDT (timeframe 1D, ~2010–prezent). Model conceptual, nu recomandare financiară.
      </p>
      <div class="pill">
        <span class="pill-dot"></span>
        <span>Model coeziv – structură vs direcționalitate</span>
      </div>
    </div>

    <!-- Explicații scurte -->
    <div class="section-card">
      <div class="section-title">Model coeziv – structură &amp; direcționalitate</div>
      <div class="section-subtitle">
        Regimuri bull/bear sunt detectate automat acolo unde <strong>structura</strong> este puternică și
        <strong>direcționalitatea</strong> susține sau contrazice trendul dominant.
      </div>
      <div class="chips-row">
        <div class="chip">
          <span class="chip-bullet"></span>
          <span><strong>Bull</strong>: structură IC_BTC ridicată + mișcări aliniate trendului (ICD_BTC ridicat).</span>
        </div>
        <div class="chip">
          <span class="chip-bullet"></span>
          <span><strong>Bear</strong>: structură IC_BTC ridicată + mișcări contra trendului (ICD_BTC foarte scăzut).</span>
        </div>
      </div>

      <div class="back-row">
        <a href="ic_btc.html" class="back-btn">
          <span class="icon">←</span>
          <span>Înapoi la indice IC_BTC</span>
        </a>
      </div>

      <!-- Metrici -->
      <div class="grid-two" id="summary-cards">
        <div class="metric-card">
          <div class="metric-label">Număr regimuri bull detectate</div>
          <div class="metric-value-row">
            <div class="metric-value" id="bullCount">–</div>
            <div class="metric-pill bull">
              <span class="metric-dot bull"></span>
              <span>bull</span>
            </div>
          </div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Număr regimuri bear detectate</div>
          <div class="metric-value-row">
            <div class="metric-value" id="bearCount">–</div>
            <div class="metric-pill bear">
              <span class="metric-dot bear"></span>
              <span>bear</span>
            </div>
          </div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Cel mai lung bull (zile)</div>
          <div class="metric-value-row">
            <div class="metric-value" id="longestBull">–</div>
          </div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Cel mai lung bear (zile)</div>
          <div class="metric-value-row">
            <div class="metric-value" id="longestBear">–</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Grafic + tabel -->
    <div class="chart-card">
      <div class="chart-header">
        <div class="chart-title">
          Regimuri bull &amp; bear (0–100, model coeziv)
        </div>
        <div class="legend-inline">
          <div class="legend-row">
            <span class="legend-swatch struct"></span>
            <span class="legend-label">IC_BTC structural (0–100)</span>
          </div>
          <div class="legend-row">
            <span class="legend-swatch dir"></span>
            <span class="legend-label">ICD_BTC direcțional (0–100)</span>
          </div>
        </div>
      </div>
      <p class="section-subtitle">
        Fundal verde = bull market, fundal roșu = bear market. Liniile reprezintă indicii IC_BTC structural și
        ICD_BTC direcțional (0–100), calculați automat din preț.
      </p>

      <canvas id="regimesChart"></canvas>

      <!-- Tabel regimuri -->
      <table>
        <thead>
          <tr>
            <th>Tip</th>
            <th>Început</th>
            <th>Sfârșit</th>
            <th>Durată<br />(zile)</th>
          </tr>
        </thead>
        <tbody id="regimesTableBody">
          <!-- completat din JS -->
        </tbody>
      </table>

      <div class="note">
        <strong>Notă</strong>: Pragurile sunt aproximative și conceptuale (nu recomandare financiară):
        <code>bull ≈ structură IC_BTC ≥ 45</code> și <code>ICD_BTC ≥ 55</code>,
        <code>bear ≈ structură ≥ 45</code> și <code>ICD_BTC ≤ 45</code>,
        cu durată minimă ~30 zile. Modelul este gândit mai mult ca un
        <em>„detector de regimuri”</em> bazat pe structură &amp; direcționalitate, nu ca sistem de semnale.
      </div>
    </div>
  </div>

  <script>
    const DateTime = luxon.DateTime;

    // ---------- Utilitare numerice ----------
    function ema(prev, value, alpha) {
      if (prev == null || !isFinite(prev)) return value;
      return alpha * value + (1 - alpha) * prev;
    }

    function normalizeTo01(arr) {
      let min = Infinity;
      let max = -Infinity;
      for (const v of arr) {
        if (!isFinite(v)) continue;
        if (v < min) min = v;
        if (v > max) max = v;
      }
      if (!isFinite(min) || !isFinite(max) || max - min === 0) {
        return arr.map(() => 0.5);
      }
      return arr.map(v => (v - min) / (max - min));
    }

    // ---------- Calcul IC_BTC structural & direcțional ----------
    function computeCoeziveIndices(ohlc) {
      if (!ohlc || ohlc.length < 60) return [];

      const alphaShort = 2 / (20 + 1); // ~1 lună
      const alphaLong = 2 / (100 + 1); // ~5 luni
      const alphaTrendShort = 2 / (30 + 1);
      const alphaTrendLong = 2 / (120 + 1);

      const res = [];

      let prevClose = null;
      let volShort = null;
      let volLong = null;
      let trendShort = null;
      let trendLong = null;

      for (let i = 0; i < ohlc.length; i++) {
        const row = ohlc[i];
        const close = Number(row.close);
        const ts = Number(row.timestamp);

        if (!isFinite(close) || !isFinite(ts)) continue;

        let ret = 0;
        if (prevClose != null && prevClose > 0) {
          ret = Math.log(close / prevClose);
        }
        prevClose = close;

        const absRet = Math.abs(ret);

        volShort = ema(volShort, absRet, alphaShort);
        volLong = ema(volLong, absRet, alphaLong);
        trendShort = ema(trendShort, close, alphaTrendShort);
        trendLong = ema(trendLong, close, alphaTrendLong);

        if (
          volShort == null ||
          volLong == null ||
          trendShort == null ||
          trendLong == null
        ) {
          continue;
        }

        // structură: cât de "calm" este fluxul relativ la context
        let structRaw = 1 - Math.min(1, volShort / Math.max(volLong, 1e-8));

        // direcțional: cât de mult sunt mișcările aliniate cu direcția trendului mare
        const bigTrendDir = trendShort >= trendLong ? 1 : -1;
        const dailyDir = ret >= 0 ? 1 : -1;
        const align = bigTrendDir * dailyDir; // 1 = aliniat, -1 = contra

        // smooth alignment via EMA pentru a nu fi zgomot de zi cu zi
        const prev = res.length ? res[res.length - 1] : null;
        let alignSmooth = align;
        if (prev) {
          alignSmooth = ema(prev._alignSmooth, align, 0.15);
        }

        res.push({
          timestamp: ts,
          close,
          structRaw,
          alignRaw: alignSmooth,
          _alignSmooth: alignSmooth
        });
      }

      // normalizare 0–100
      const structArr = res.map(r => r.structRaw);
      const alignArr = res.map(r => r.alignRaw);

      const structNorm = normalizeTo01(structArr);
      const alignNorm = normalizeTo01(alignArr);

      return res.map((r, idx) => ({
        timestamp: r.timestamp,
        close: r.close,
        ic_struct: Math.round(structNorm[idx] * 10000) / 100,
        ic_dir: Math.round(alignNorm[idx] * 10000) / 100
      }));
    }

    // ---------- Detecție regimuri bull / bear ----------
    function detectRegimes(indices, config = {}) {
      const {
        structBull = 45,
        dirBull = 55,
        structBear = 45,
        dirBear = 45,
        minDays = 30
      } = config;

      const regimes = [];
      let currentType = null; // "bull" | "bear" | null
      let startIdx = null;

      function closeRegime(endIdx) {
        if (currentType == null || startIdx == null) return;
        const start = indices[startIdx];
        const end = indices[endIdx];
        if (!start || !end) return;
        const days =
          Math.round(
            (end.timestamp - start.timestamp) / (1000 * 60 * 60 * 24)
          ) + 1;
        if (days >= minDays) {
          regimes.push({
            type: currentType,
            start: start.timestamp,
            end: end.timestamp,
            days
          });
        }
      }

      for (let i = 0; i < indices.length; i++) {
        const p = indices[i];
        const s = p.ic_struct;
        const d = p.ic_dir;

        const isBull = s >= structBull && d >= dirBull;
        const isBear = s >= structBear && d <= dirBear;

        let newType = null;
        if (isBull && !isBear) newType = "bull";
        else if (isBear && !isBull) newType = "bear";

        if (newType === currentType) continue;

        if (currentType !== null && newType !== currentType) {
          closeRegime(i - 1);
        }

        currentType = newType;
        startIdx = newType ? i : null;
      }

      if (currentType !== null && startIdx != null) {
        closeRegime(indices.length - 1);
      }

      return regimes;
    }

    // ---------- Plugin Chart.js pentru fundal bull/bear ----------
    const regimeBackgroundPlugin = {
      id: "regimeBackground",
      beforeDraw(chart, args, pluginOptions) {
        const regimes = pluginOptions && pluginOptions.regimes;
        if (!regimes || !regimes.length) return;

        const { ctx, chartArea, scales } = chart;
        const xAxis = scales.x;
        if (!xAxis) return;

        ctx.save();

        for (const r of regimes) {
          // IMPORTANT: convertim timestamp → Date pentru getPixelForValue
          const startDate = DateTime.fromMillis(r.start).toJSDate();
          const endDate = DateTime.fromMillis(r.end).toJSDate();

          const xStart = xAxis.getPixelForValue(startDate);
          const xEnd = xAxis.getPixelForValue(endDate);
          const width = xEnd - xStart;

          if (!isFinite(width) || width <= 0) continue;

          ctx.fillStyle =
            r.type === "bull"
              ? "rgba(34,197,94,0.13)"  // verde soft
              : "rgba(248,113,113,0.13)"; // roșu soft

          ctx.fillRect(
            xStart,
            chartArea.top,
            width,
            chartArea.bottom - chartArea.top
          );
        }

        ctx.restore();
      }
    };

    Chart.register(regimeBackgroundPlugin);

    // ---------- Helper UI ----------
    function formatDate(ts) {
      return DateTime.fromMillis(ts).toFormat("yyyy-LL-dd");
    }

    // ---------- Main ----------
    async function main() {
      try {
        const resp = await fetch("btc_ohlc.json");
        if (!resp.ok) {
          throw new Error("Nu pot încărca btc_ohlc.json: " + resp.status);
        }
        const raw = await resp.json();

        const indices = computeCoeziveIndices(raw);
        if (!indices.length) throw new Error("Nu s-au putut calcula indicii coezivi.");

        const regimes = detectRegimes(indices, {
          structBull: 45,
          dirBull: 55,
          structBear: 45,
          dirBear: 45,
          minDays: 30
        });

        // Statistici
        const bullCount = regimes.filter(r => r.type === "bull").length;
        const bearCount = regimes.filter(r => r.type === "bear").length;
        const longestBull = Math.max(
          0,
          ...regimes.filter(r => r.type === "bull").map(r => r.days)
        );
        const longestBear = Math.max(
          0,
          ...regimes.filter(r => r.type === "bear").map(r => r.days)
        );

        document.getElementById("bullCount").textContent = bullCount;
        document.getElementById("bearCount").textContent = bearCount;
        document.getElementById("longestBull").textContent =
          longestBull > 0 ? longestBull : "–";
        document.getElementById("longestBear").textContent =
          longestBear > 0 ? longestBear : "–";

        // Date pentru grafic
        const structPoints = indices.map(p => ({
          x: DateTime.fromMillis(p.timestamp).toJSDate(),
          y: p.ic_struct
        }));
        const dirPoints = indices.map(p => ({
          x: DateTime.fromMillis(p.timestamp).toJSDate(),
          y: p.ic_dir
        }));

        // Chart
        const ctx = document.getElementById("regimesChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            datasets: [
              {
                label: "IC_BTC structural (0–100)",
                data: structPoints,
                parsing: false,
                borderColor: "rgba(56,189,248,1)",
                backgroundColor: "rgba(56,189,248,0.0)",
                borderWidth: 1.6,
                pointRadius: 0,
                tension: 0.2
              },
              {
                label: "ICD_BTC direcțional (0–100)",
                data: dirPoints,
                parsing: false,
                borderColor: "rgba(248,113,113,1)",
                backgroundColor: "rgba(248,113,113,0.0)",
                borderWidth: 1.3,
                pointRadius: 0,
                tension: 0.15
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              mode: "index",
              intersect: false
            },
            scales: {
              x: {
                type: "time",
                time: {
                  unit: "year",
                  tooltipFormat: "yyyy-LL-dd"
                },
                grid: {
                  color: "rgba(30,64,175,0.5)",
                  tickLength: 4
                },
                ticks: {
                  color: "rgba(148,163,184,0.9)",
                  maxTicksLimit: 9
                }
              },
              y: {
                min: 0,
                max: 100,
                grid: {
                  color: "rgba(31,41,55,0.9)"
                },
                ticks: {
                  color: "rgba(148,163,184,0.9)",
                  callback: (v) => v
                }
              }
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                backgroundColor: "rgba(15,23,42,0.98)",
                borderColor: "rgba(148,163,184,0.7)",
                borderWidth: 1,
                padding: 10,
                titleFont: { size: 12, weight: "600" },
                bodyFont: { size: 11 },
                callbacks: {
                  title: (items) => {
                    if (!items.length) return "";
                    const ts = items[0].parsed.x;
                    return DateTime.fromMillis(ts).toFormat("yyyy-LL-dd");
                  },
                  label: (item) => {
                    const label = item.dataset.label || "";
                    const v = item.parsed.y != null ? item.parsed.y.toFixed(2) : "";
                    return `${label}: ${v}`;
                  }
                }
              },
              regimeBackground: {
                regimes
              }
            }
          }
        });

        // Tabel regimuri
        const tbody = document.getElementById("regimesTableBody");
        tbody.innerHTML = "";

        regimes.forEach((r) => {
          const tr = document.createElement("tr");

          const tdType = document.createElement("td");
          const badge = document.createElement("span");
          badge.className = "regime-badge " + (r.type === "bull" ? "bull" : "bear");
          const dot = document.createElement("span");
          dot.className = "regime-dot " + (r.type === "bull" ? "bull" : "bear");
          const label = document.createElement("span");
          label.textContent = r.type + " market";
          badge.appendChild(dot);
          badge.appendChild(label);
          tdType.appendChild(badge);

          const tdStart = document.createElement("td");
          tdStart.textContent = formatDate(r.start);

          const tdEnd = document.createElement("td");
          tdEnd.textContent = formatDate(r.end);

          const tdDays = document.createElement("td");
          tdDays.textContent = r.days;

          tr.appendChild(tdType);
          tr.appendChild(tdStart);
          tr.appendChild(tdEnd);
          tr.appendChild(tdDays);

          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error(err);
        document.getElementById("bullCount").textContent = "–";
        document.getElementById("bearCount").textContent = "–";
        document.getElementById("longestBull").textContent = "–";
        document.getElementById("longestBear").textContent = "–";
      }
    }

    main();
  </script>
</body>
</html>
