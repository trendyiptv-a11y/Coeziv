<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Coheziv 3.14 – Simulator (MVP)</title>
  <style>
    :root{
      --bg:#fcfcfc;
      --card:#ffffff;
      --text:#111;
      --muted:#555;
      --border:#e6e6e6;
      --border2:#d8d8d8;
      --soft:#fafafa;
      --shadow: 0 6px 16px rgba(0,0,0,0.04);
      --danger-bg:#fff7f7;
      --danger-b:#ffd6d6;
      --accent:#111;
      --disabled:#f2f2f2;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      line-height:1.4;
    }
    main{
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 18px 60px;
    }
    h1{margin:0;font-size:28px}
    p{margin:10px 0;color:var(--muted)}
    .badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .badge{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #ddd;
      font-size:12px;
      background:#fafafa;
      color:#222;
    }
    .progress{display:flex;gap:10px;margin:14px 0 22px}
    .bar{flex:1;height:8px;border-radius:999px;background:#e7e7e7}
    .bar.on{background:#111}
    .card{
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px;
      box-shadow: var(--shadow);
      background:var(--card);
    }
    h2{margin:0 0 10px}
    label{display:block;margin-top:12px;font-weight:600;color:#222}
    select, textarea, input[type="text"]{
      margin-top:6px;
      padding:10px;
      width:100%;
      border-radius:10px;
      border:1px solid var(--border2);
      background:#fff;
      font:inherit;
    }
    textarea{resize:vertical}
    input[type="range"]{width:100%; margin-top:6px}
    .hint{
      margin-top:10px;
      color:#b00020;
    }
    .panel{
      margin-top:14px;
      padding:12px;
      border-radius:12px;
      background:var(--soft);
      border:1px solid #eee;
      color:#333;
    }
    .panel strong{display:block;margin-bottom:6px}
    .grid-actions{
      display:flex;
      gap:10px;
      margin-top:18px;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    button{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--border2);
      background:#fff;
      cursor:pointer;
      font:inherit;
    }
    button.primary{
      border:1px solid var(--accent);
      background:var(--accent);
      color:#fff;
    }
    button:disabled{
      background:var(--disabled);
      cursor:not-allowed;
      color:#777;
    }
    .danger{
      margin-top:14px;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--danger-b);
      background:var(--danger-bg);
      color:#333;
    }
    .danger b{display:block;margin-bottom:6px}
    ul{margin:0;padding-left:18px}
    li{margin-bottom:6px}
    footer{
      margin-top:14px;
      color:#666;
      font-size:12px;
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .row .badge{background:#fff}
    .thermo{
      margin-top:14px;
      border:1px solid #eee;
      border-radius:14px;
      padding:12px;
      background:#fff;
    }
    .thermo .scale{
      position:relative;
      height:140px;
      border-radius:12px;
      background:linear-gradient(#f7f7f7,#fff);
      border:1px solid #eee;
      overflow:hidden;
    }
    .thermo .marker{
      position:absolute;
      left:0;
      right:0;
      height:2px;
      background:#111;
      opacity:0.25;
    }
    .thermo .label{
      position:absolute;
      left:10px;
      top:-10px;
      font-size:12px;
      color:#444;
      background:#fff;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid #eee;
    }
    .thermo .dot{
      position:absolute;
      right:10px;
      width:10px;
      height:10px;
      border-radius:999px;
      background:#111;
      transform: translateY(-50%);
    }
    .small{font-size:12px;color:#666;margin-top:8px}
    .topline{margin-bottom:18px}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body>
  <main>
    <header class="topline">
      <h1>Coheziv 3.14 – Simulator de stare (MVP)</h1>
      <p>
        Implementare MVP a ciclului 2π (Structură → Flux → Reorganizare → Noua structură) și a zonelor conceptuale
        (≈25°C, ≈39.86°C, ≈43°C, &gt;44.7°C). Model conceptual, nu instrument clinic.
      </p>
      <div class="badges">
        <span class="badge" id="badgeStep">Step 1/3</span>
        <span class="badge">Disclaimer: non-clinic</span>
        <span class="badge">Fără 3.14 numeric în alte domenii</span>
      </div>
    </header>

    <div class="progress" aria-label="Progress">
      <div class="bar on" id="bar1"></div>
      <div class="bar" id="bar2"></div>
      <div class="bar" id="bar3"></div>
    </div>

    <section class="card" id="card">
      <!-- Step content injected here -->
    </section>

    <footer>
      Notă: zonele ≈25°C / ≈39.86°C / ≈43°C / &gt;44.7°C sunt folosite ca <b>repere conceptuale</b> pentru coeziune,
      tensiune și supraîncărcare. Nu reprezintă măsurare fizică a apei, diagnostic medical sau evaluare psihologică.
    </footer>
  </main>

<script>
(function(){
  // ---------- State ----------
  const defaultState = () => ({
    step: 1,
    domain: "",
    structureDesc: "",
    structureLevel: 3, // 1..5
    fluxType: "informațional",
    fluxIntensity: 3, // 1..5
    fluxDuration: "mediu",
  });

  const STORAGE_KEY = "coheziv314_mvp_state_v1";

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return defaultState();
      const s = JSON.parse(raw);
      return { ...defaultState(), ...s };
    }catch(e){
      return defaultState();
    }
  }

  function saveState(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }catch(e){}
  }

  let state = loadState();

  // ---------- Helpers ----------
  const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

  function computeResult(s){
    const structure = clamp(+s.structureLevel, 1, 5);
    const intensity = clamp(+s.fluxIntensity, 1, 5);

    const durationWeight = { "scurt": 0, "mediu": 1, "prelungit": 2 };
    const typeWeight = {
      "informațional": 1,
      "emoțional": 1,
      "sarcini/cerințe": 2,
      "schimbare externă": 1
    };

    const score =
      structure +
      intensity +
      (durationWeight[s.fluxDuration] ?? 1) +
      (typeWeight[s.fluxType] ?? 1);

    let phase2pi = "Flux (F)";
    if(score <= 5) phase2pi = "Structură (S₀)";
    else if(score <= 9) phase2pi = "Flux (F)";
    else if(score <= 12) phase2pi = "Reorganizare (R)";
    else phase2pi = "Noua structură (S₁)";

    let zone = "≈25°C";
    if(score <= 6) zone = "≈25°C";
    else if(score <= 10) zone = "≈39.86°C";
    else if(score <= 12) zone = "≈43°C";
    else zone = ">44.7°C";

    const messages = {
      "≈25°C":
        "Sistemul este într-o stare flexibilă și adaptabilă. Coeziunea este suficientă pentru funcționare, iar integrarea fluxurilor este ușoară.",
      "≈39.86°C":
        "Sistemul este într-o zonă de tensiune reversibilă. Fluxurile sunt semnificative, dar reorganizarea poate readuce echilibrul.",
      "≈43°C":
        "Sistemul este într-o zonă de coeziune ridicată și coerentă, dar cu flexibilitate scăzută. Reorganizarea trebuie făcută disciplinat pentru a evita rigidizarea sau supraîncărcarea.",
      ">44.7°C":
        "Sistemul este într-o zonă de supraîncărcare conceptuală. Structura începe să cedeze; este necesară reducerea fluxului și o reorganizare clară pentru a evita colapsul structural."
    };

    const notes = [];
    notes.push("Domeniu declarat: " + (s.domain || "(neselectat)"));
    notes.push("Structură (1–5): " + structure);
    notes.push("Flux: " + s.fluxType + ", intensitate (1–5): " + intensity + ", durată: " + s.fluxDuration);

    return { score, zone, phase2pi, message: messages[zone], notes };
  }

  function setStep(n){
    state.step = n;
    saveState();
    render();
  }

  function updateProgress(){
    document.getElementById("badgeStep").textContent = "Step " + state.step + "/3";
    document.getElementById("bar1").classList.toggle("on", state.step >= 1);
    document.getElementById("bar2").classList.toggle("on", state.step >= 2);
    document.getElementById("bar3").classList.toggle("on", state.step >= 3);
  }

  function thermoPosition(zone){
    // Map zone to y position on 0..100 (top..bottom) scale for the dot.
    // Not scientific; UI cue only.
    if(zone === ">44.7°C") return 12;
    if(zone === "≈43°C") return 35;
    if(zone === "≈39.86°C") return 58;
    return 82; // ≈25°C
  }

  // ---------- Render ----------
  function render(){
    updateProgress();
    const card = document.getElementById("card");
    card.innerHTML = "";

    if(state.step === 1){
      card.appendChild(step1());
      card.appendChild(actions());
    } else if(state.step === 2){
      card.appendChild(step2());
      card.appendChild(actions());
    } else {
      card.appendChild(step3());
      card.appendChild(actions());
    }
  }

  function step1(){
    const root = document.createElement("div");
    root.innerHTML = `
      <h2>1) Structură (S₀)</h2>

      <label for="domain">Domeniu (obligatoriu)</label>
      <select id="domain">
        <option value="">Alege domeniul…</option>
        <option value="psihologic">psihologic</option>
        <option value="social">social</option>
        <option value="tehnic">tehnic</option>
      </select>

      <label for="structureDesc">Descriere structură (scurt)</label>
      <textarea id="structureDesc" rows="4" placeholder="Ex: roluri clare, reguli de comunicare, limitări de resurse…"></textarea>

      <label for="structureLevel">Nivel de structurare: <span id="slVal"></span> (1 flexibil → 5 rigid)</label>
      <input type="range" id="structureLevel" min="1" max="5" step="1" />

      <div class="panel">
        <strong>Regulă de meta-coerență</strong>
        Domeniul trebuie declarat înainte de aplicarea modelului.
      </div>

      <div id="domainHint" class="hint" style="display:none">
        Selectează domeniul ca să păstrăm meta-coerența aplicării.
      </div>
    `;

    const domain = root.querySelector("#domain");
    const structureDesc = root.querySelector("#structureDesc");
    const structureLevel = root.querySelector("#structureLevel");
    const slVal = root.querySelector("#slVal");

    domain.value = state.domain;
    structureDesc.value = state.structureDesc;
    structureLevel.value = String(state.structureLevel);
    slVal.textContent = String(state.structureLevel);

    domain.addEventListener("change", (e)=>{
      state.domain = e.target.value;
      saveState();
      render(); // refresh hint/buttons
    });

    structureDesc.addEventListener("input", (e)=>{
      state.structureDesc = e.target.value;
      saveState();
    });

    structureLevel.addEventListener("input", (e)=>{
      state.structureLevel = +e.target.value;
      slVal.textContent = String(state.structureLevel);
      saveState();
    });

    return root;
  }

  function step2(){
    const root = document.createElement("div");
    root.innerHTML = `
      <h2>2) Flux (F)</h2>

      <label for="fluxType">Tip flux</label>
      <select id="fluxType">
        <option value="informațional">informațional</option>
        <option value="emoțional">emoțional</option>
        <option value="sarcini/cerințe">sarcini/cerințe</option>
        <option value="schimbare externă">schimbare externă</option>
      </select>

      <label for="fluxIntensity">Intensitate flux: <span id="fiVal"></span> (1 mic → 5 mare)</label>
      <input type="range" id="fluxIntensity" min="1" max="5" step="1" />

      <label for="fluxDuration">Durată</label>
      <select id="fluxDuration">
        <option value="scurt">scurt</option>
        <option value="mediu">mediu</option>
        <option value="prelungit">prelungit</option>
      </select>

      <div class="panel">
        <strong>Previzualizare internă (conceptuală)</strong>
        <div class="row">
          <span class="badge">Structură: <span id="pvS"></span>/5</span>
          <span class="badge">Intensitate: <span id="pvI"></span>/5</span>
          <span class="badge">Durată: <span id="pvD"></span></span>
        </div>
        <div class="small">Aceasta este o vizualizare de parametri, nu o măsurare științifică.</div>
      </div>
    `;

    const fluxType = root.querySelector("#fluxType");
    const fluxIntensity = root.querySelector("#fluxIntensity");
    const fluxDuration = root.querySelector("#fluxDuration");

    const fiVal = root.querySelector("#fiVal");
    const pvS = root.querySelector("#pvS");
    const pvI = root.querySelector("#pvI");
    const pvD = root.querySelector("#pvD");

    fluxType.value = state.fluxType;
    fluxIntensity.value = String(state.fluxIntensity);
    fluxDuration.value = state.fluxDuration;

    fiVal.textContent = String(state.fluxIntensity);
    pvS.textContent = String(state.structureLevel);
    pvI.textContent = String(state.fluxIntensity);
    pvD.textContent = state.fluxDuration;

    fluxType.addEventListener("change", (e)=>{
      state.fluxType = e.target.value;
      saveState();
    });

    fluxIntensity.addEventListener("input", (e)=>{
      state.fluxIntensity = +e.target.value;
      fiVal.textContent = String(state.fluxIntensity);
      pvI.textContent = String(state.fluxIntensity);
      saveState();
    });

    fluxDuration.addEventListener("change", (e)=>{
      state.fluxDuration = e.target.value;
      pvD.textContent = state.fluxDuration;
      saveState();
    });

    return root;
  }

  function step3(){
    const r = computeResult(state);

    const root = document.createElement("div");
    root.innerHTML = `
      <h2>3) Rezultat</h2>

      <div class="row">
        <span class="badge">Zonă: <b>${r.zone}</b></span>
        <span class="badge">Fază 2π: <b>${r.phase2pi}</b></span>
        <span class="badge">Domeniu: <b>${state.domain || "(neselectat)"}</b></span>
      </div>

      <p style="margin-top:12px;font-size:16px;line-height:1.5;color:#222">${r.message}</p>

      <div class="thermo" aria-label="Thermometer (conceptual)">
        <strong>Termometru conceptual (indicator vizual)</strong>
        <div class="scale" style="margin-top:8px">
          <div class="marker" style="top:18%"></div>
          <div class="label" style="top:14%">>44.7°C</div>

          <div class="marker" style="top:40%"></div>
          <div class="label" style="top:36%">≈43°C</div>

          <div class="marker" style="top:62%"></div>
          <div class="label" style="top:58%">≈39.86°C</div>

          <div class="marker" style="top:84%"></div>
          <div class="label" style="top:80%">≈25°C</div>

          <div class="dot" id="dot"></div>
        </div>
        <div class="small">Acest termometru este o metaforă UI; nu este măsurare fizică.</div>
      </div>

      <div class="panel">
        <strong>Context (trasabilitate)</strong>
        <ul id="notes"></ul>
      </div>

      <div class="danger">
        <b>Disclaimer</b>
        Acest rezultat este produs de un <b>model conceptual</b> inspirat de proprietățile apei și praguri termice folosite ca repere.
        Nu reprezintă diagnostic, evaluare medicală sau psihologică și nu pretinde măsurare experimentală a unei stări reale.
      </div>

      <div class="panel">
        <strong>Notă tehnică (intern)</strong>
        Scor intern (doar pentru selectarea regimului): <span class="mono">${r.score}</span>
      </div>
    `;

    const notesEl = root.querySelector("#notes");
    r.notes.forEach(n=>{
      const li = document.createElement("li");
      li.textContent = n;
      notesEl.appendChild(li);
    });

    const dot = root.querySelector("#dot");
    dot.style.top = thermoPosition(r.zone) + "%";

    return root;
  }

  function actions(){
    const wrap = document.createElement("div");
    wrap.className = "grid-actions";

    const btnBack = document.createElement("button");
    btnBack.textContent = "Înapoi";
    btnBack.disabled = state.step === 1;
    btnBack.addEventListener("click", ()=>{
      if(state.step > 1) setStep(state.step - 1);
    });

    const right = document.createElement("div");
    right.style.display = "flex";
    right.style.gap = "10px";
    right.style.flexWrap = "wrap";

    const btnNext = document.createElement("button");
    btnNext.textContent = "Continuă";
    btnNext.className = "primary";

    const btnCopy = document.createElement("button");
    btnCopy.textContent = "Copiază rezultat";

    const btnReset = document.createElement("button");
    btnReset.textContent = "Reset";

    const domainOk = state.domain !== "";
    if(state.step === 1 && !domainOk){
      btnNext.disabled = true;
    }

    btnNext.addEventListener("click", ()=>{
      if(state.step === 1 && !domainOk){
        // show hint by rerender (step1 toggles)
        render();
        const hint = document.querySelector("#domainHint");
        if(hint) hint.style.display = "block";
        return;
      }
      if(state.step < 3) setStep(state.step + 1);
    });

    btnCopy.addEventListener("click", async ()=>{
      const r = computeResult(state);
      const text = [
        "Coheziv 3.14 – Rezultat (model conceptual)",
        "Zonă: " + r.zone,
        "Fază 2π: " + r.phase2pi,
        "Mesaj: " + r.message,
        ...r.notes.map(n => "- " + n),
        "",
        "Disclaimer: model conceptual, non-clinic."
      ].join("\n");
      try{
        await navigator.clipboard.writeText(text);
        alert("Rezultatul a fost copiat.");
      }catch(e){
        // fallback
        prompt("Copiază manual:", text);
      }
    });

    btnReset.addEventListener("click", ()=>{
      state = defaultState();
      saveState();
      render();
    });

    if(state.step === 3){
      right.appendChild(btnCopy);
      right.appendChild(btnReset);
    } else {
      right.appendChild(btnNext);
    }

    wrap.appendChild(btnBack);
    wrap.appendChild(right);

    return wrap;
  }

  // ---------- Boot ----------
  render();
})();
</script>
</body>
</html>
