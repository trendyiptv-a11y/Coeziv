<script>
async function analyze() {
  const text = document.getElementById("inputText").value.trim();
  const resultBox = document.getElementById("result");
  if (!text) return alert("Introdu o propoziție pentru analiză.");

  resultBox.style.display = "block";
  resultBox.innerHTML = "⏳ Se analizează...";

  try {
    const response = await fetch("/api/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await response.json();

    if (data.error) {
      resultBox.innerHTML = `<p style='color: var(--false)'>Eroare: ${data.error}</p>`;
      return;
    }

    // 🧠 Verdict logic
    let symbol = "⚪", color = "var(--neutral)";
    if (data.truth === "adevărat") { symbol = "✅"; color = "var(--true)"; }
    else if (data.truth === "fals") { symbol = "❌"; color = "var(--false)"; }

    const sources = (data.sources || [])
      .map(s => `<a class="source-link" href="${s.link}" target="_blank">${s.title}</a>`)
      .join("") || "<p style='color: var(--muted)'>Nicio sursă relevantă.</p>";

    const correction = data.correction
      ? `<p style='color: var(--true)'><b>ℹ️ Informația corectă:</b> ${data.correction}</p>`
      : "";

    resultBox.innerHTML = `
      <p class="type-${data.type}">📘 Tip: ${data.type}</p>
      <p style="color:${color}">${symbol} <b>Verdict:</b> ${data.verdict}</p>
      <p><b>Scor:</b> ${data.score.toFixed(2)} / ${data.maxScore}</p>
      <div class="score-bar">
        <div class="score-bar-inner" style="width:${(data.score/data.maxScore)*100}%; background-color:${color};"></div>
      </div>
      <p style="margin-top:1rem;">${data.explanation}</p>
      ${correction}
      <h4>🔗 Surse:</h4>
      ${sources}
    `;
  } catch (err) {
    resultBox.innerHTML = `<p style='color: var(--false)'>Eroare: ${err.message}</p>`;
  }
}
</script>
