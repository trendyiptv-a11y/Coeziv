<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formula Coeziunii 3.14Î”H</title>
<style>
  body {
    background-color: #0d1117;
    color: #c9d1d9;
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    padding: 2rem 1rem;
    overflow-x: hidden;
  }
  h1 {
    color: #00ffb7;
    font-size: 2rem;
    margin-bottom: 0.3rem;
  }
  p {
    color: #9ba1a6;
  }
  textarea {
    width: 90%;
    max-width: 500px;
    height: 100px;
    border-radius: 10px;
    border: none;
    padding: 10px;
    background: #161b22;
    color: #fff;
    resize: none;
  }
  button {
    background: #00ffb7;
    color: #000;
    border: none;
    border-radius: 10px;
    padding: 10px 20px;
    margin-top: 10px;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {
    background: #00cfa0;
  }
  #result {
    margin-top: 1rem;
    color: #fff;
  }

  /* Card coeziv - mic È™i discret */
  #coeziv-card {
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: rgba(15, 17, 21, 0.85);
    color: #f1f1f1;
    font-size: 0.85rem;
    padding: 6px 12px;
    border-radius: 10px;
    box-shadow: 0 0 10px 2px #ffbb00;
    transition: box-shadow 1s ease, background 1s ease;
    z-index: 1000;
  }
</style>
</head>
<body>

  <h1>Formula Coeziunii 3.14Î”H</h1>
  <p>IntroduceÈ›i o afirmaÈ›ie pentru analizÄƒ:</p>
  <textarea id="inputText" placeholder="Scrie aici afirmaÈ›ia ta..."></textarea><br>
  <button onclick="analizeazaAfirmatia()">AnalizeazÄƒ</button>
  <div id="result"></div>

  <!-- Panoul manifest - corect poziÈ›ionat -->
  <div id="manifest-panel" class="partial"></div>

  <!-- Card coeziv -->
  <div id="coeziv-card">
    <span id="deltaText">Stare de funcÈ›ionare: actualizare vie...</span>
  </div>

<script>
  // --- Motorul de analizÄƒ (nemodificat) ---
  function analizeazaAfirmatia() {
    const text = document.getElementById("inputText").value.trim();
    if (!text) return alert("Scrie o afirmaÈ›ie!");
    document.getElementById("result").innerHTML = "<p>Se analizeazÄƒ...</p>";
    fetch(`/api/analyze?text=${encodeURIComponent(text)}`)
      .then(r => r.json())
      .then(d => { document.getElementById("result").innerHTML = d.result; })
      .catch(() => { document.getElementById("result").innerHTML = "Eroare la analizÄƒ."; });
  }

  // --- Actualizarea vie a stÄƒrii sistemului ---
  async function actualizeazaFormulaViva() {
    try {
      const r = await fetch('/manifest.json');
      const manifest = await r.json();
      const dh = parseFloat(manifest.cohesionState?.value || 2.57);
      const text = document.getElementById('deltaText');
      let mesaj = "Stare de funcÈ›ionare: ";

      if (dh < 2.8) mesaj += "instabilÄƒ ðŸŸ¥";
      else if (dh < 3.13) mesaj += "normalÄƒ ðŸŸ¨";
      else mesaj += "optimÄƒ ðŸŸ©";

      text.textContent = mesaj;

      const card = document.getElementById('coeziv-card');
      if (dh < 2.8) card.style.boxShadow = '0 0 10px 2px #ff4444';
      else if (dh < 3.13) card.style.boxShadow = '0 0 10px 2px #ffbb00';
      else card.style.boxShadow = '0 0 10px 2px #00ff88';

      setTimeout(actualizeazaFormulaViva, 30000);
    } catch (e) {
      console.warn('Eroare actualizare vie:', e);
    }
  }
  actualizeazaFormulaViva();
</script>

</body>
</html>
