<script>
async function analyze() {
  const text = document.getElementById("inputText").value.trim();
  const resultBox = document.getElementById("result");
  if (!text) return alert("Introdu o propoziÈ›ie pentru analizÄƒ.");

  resultBox.style.display = "block";
  resultBox.innerHTML = "â³ Se analizeazÄƒ...";

  try {
    const response = await fetch("/api/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await response.json();

    if (data.error) {
      resultBox.innerHTML = `<p style='color: var(--false)'>Eroare: ${data.error}</p>`;
      return;
    }

    // ğŸ§  Verdict logic
    let symbol = "âšª", color = "var(--neutral)";
    if (data.truth === "adevÄƒrat") { symbol = "âœ…"; color = "var(--true)"; }
    else if (data.truth === "fals") { symbol = "âŒ"; color = "var(--false)"; }

    const sources = (data.sources || [])
      .map(s => `<a class="source-link" href="${s.link}" target="_blank">${s.title}</a>`)
      .join("") || "<p style='color: var(--muted)'>Nicio sursÄƒ relevantÄƒ.</p>";

    const correction = data.correction
      ? `<p style='color: var(--true)'><b>â„¹ï¸ InformaÈ›ia corectÄƒ:</b> ${data.correction}</p>`
      : "";

    resultBox.innerHTML = `
      <p class="type-${data.type}">ğŸ“˜ Tip: ${data.type}</p>
      <p style="color:${color}">${symbol} <b>Verdict:</b> ${data.verdict}</p>
      <p><b>Scor:</b> ${data.score.toFixed(2)} / ${data.maxScore}</p>
      <div class="score-bar">
        <div class="score-bar-inner" style="width:${(data.score/data.maxScore)*100}%; background-color:${color};"></div>
      </div>
      <p style="margin-top:1rem;">${data.explanation}</p>
      ${correction}
      <h4>ğŸ”— Surse:</h4>
      ${sources}
    `;
  } catch (err) {
    resultBox.innerHTML = `<p style='color: var(--false)'>Eroare: ${err.message}</p>`;
  }
}
</script>
