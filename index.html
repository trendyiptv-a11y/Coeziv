<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formula Coeziunii 3.14 + D + L</title>
<style>
  :root {
    --green: #00ffaa;
    --yellow: #ffc800;
    --orange: #ff8800;
    --red: #ff0055;
    --purple: #b000ff;
    --dark-bg: #0d1117;
    --panel: #161b22;
    --text: #c9d1d9;
  }
  body {
    background-color: var(--dark-bg);
    color: var(--text);
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    padding: 2rem 1rem;
  }
  h1 {
    color: var(--green);
    font-size: 2rem;
    margin-bottom: 0.3rem;
  }
  h2 {
    font-size: 1.1rem;
    color: #9ba1a6;
    margin-bottom: 1rem;
  }
  textarea {
    width: 90%;
    height: 120px;
    background-color: var(--panel);
    color: var(--text);
    border: 1px solid var(--green);
    border-radius: 10px;
    padding: 10px;
    font-size: 1rem;
    resize: none;
    outline: none;
  }
  button {
    margin-top: 1rem;
    padding: 12px 30px;
    background-color: var(--green);
    color: #000;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  button:hover { transform: scale(1.05); }
  #result {
    background-color: var(--panel);
    border-radius: 12px;
    padding: 1rem;
    margin-top: 1.5rem;
    width: 90%;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.5;
  }
  .highlight { color: var(--green); font-weight: bold; }
  footer {
    margin-top: 2rem;
    font-size: 0.9rem;
    color: #7c8590;
  }
  #barContainer {
    width: 90%;
    height: 16px;
    background: #333;
    border-radius: 10px;
    margin: 1rem auto;
    overflow: hidden;
  }
  #bar {
    height: 100%;
    width: 0%;
    background: var(--green);
    transition: width 0.6s ease, background 0.6s ease;
  }
</style>
</head>
<body>

  <h1>Formula Coeziunii<br>3.14 + D + L</h1>
  <h2>Motor logic de analizƒÉ semanticƒÉ »ôi logicƒÉ</h2>

  <textarea id="textInput" placeholder="Introdu textul pentru analizƒÉ..."></textarea><br>
  <button onclick="analyzeText()">üîç AnalizeazƒÉ</button>

  <div id="result"></div>

  <div id="barContainer"><div id="bar"></div></div>

  <footer>AnalizƒÉ efectuatƒÉ conform formulei 3.14 + D + L‚àû</footer>

<script>
async function analyzeText() {
  const text = document.getElementById("textInput").value.trim();
  const resultDiv = document.getElementById("result");
  const bar = document.getElementById("bar");

  resultDiv.innerHTML = "<em>Se analizeazƒÉ...</em>";
  bar.style.width = "0%";

  try {
    const response = await fetch("/.netlify/functions/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text, user: "Sergiu" })
    });

    const data = await response.json();

    // Extragem devia»õiile »ôi calculƒÉm devia»õia totalƒÉ
    const D = data.memory ? data.memory.avgD.toFixed(2) : 0;
    const L = data.memory ? data.memory.avgL.toFixed(2) : 0;
    const deviation = parseFloat(D) + parseFloat(L);

    // SetƒÉm culoarea √Æn func»õie de devia»õie
    let color = "var(--green)";
    if (deviation > 1.5 && deviation <= 3) color = "var(--yellow)";
    else if (deviation > 3 && deviation <= 4) color = "var(--orange)";
    else if (deviation > 4 && deviation <= 5.5) color = "var(--red)";
    else if (deviation > 5.5) color = "var(--purple)";

    const width = Math.min((deviation / 6.28) * 100, 100);
    bar.style.width = width + "%";
    bar.style.background = color;

    resultDiv.innerHTML = `
      <p><span class="highlight">Rezonan»õƒÉ:</span> ${data.resonance}</p>
      <p><span class="highlight">Devia»õie semanticƒÉ (D):</span> ${D}</p>
      <p><span class="highlight">Devia»õie logicƒÉ (L):</span> ${L}</p>
      <p><span class="highlight">Interpretare:</span> ${data.interpretation}</p>
      <p><span class="highlight">Tip:</span> ${data.type}</p>
      <hr>
      <p><strong>Memorie adaptivƒÉ:</strong><br>
      Analize: ${data.memory.count} | D mediu: ${D} | L mediu: ${L}</p>
      <p><small>${data.source}</small></p>
    `;
  } catch (err) {
    resultDiv.innerHTML = "<p style='color:red;'>Eroare la procesare.</p>";
  }
}
</script>

</body>
</html>
