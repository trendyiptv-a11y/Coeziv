<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Motor Coeziv 3.14Δ</title>
<style>
  :root {
    --good:#00ffb7;
    --mid:#ffc800;
    --bad:#ff0055;
    --bg:#0d1117;
    --panel:#161b22;
    --text:#c9d1d9;
  }
  body {
    background:var(--bg);
    color:var(--text);
    font-family:'Segoe UI',sans-serif;
    margin:0;
    padding:2rem 1rem;
    text-align:center;
  }
  h1 {
    color:var(--good);
    margin-bottom:.5rem;
  }
  p {color:#9ba1a6;margin-top:0;margin-bottom:2rem;}
  textarea {
    width:100%;
    max-width:600px;
    height:80px;
    background:var(--panel);
    border:1px solid #30363d;
    border-radius:10px;
    color:white;
    padding:1rem;
    resize:none;
    font-size:1rem;
  }
  button {
    background:var(--good);
    color:#000;
    font-weight:600;
    border:none;
    border-radius:10px;
    padding:.8rem 1.6rem;
    margin-top:1rem;
    cursor:pointer;
    transition:.2s;
  }
  button:hover {transform:scale(1.05);}
  #result {
    margin-top:2rem;
    max-width:700px;
    margin-inline:auto;
    background:var(--panel);
    border-radius:14px;
    padding:1.2rem;
    text-align:left;
  }
  .bar {
    height:8px;
    border-radius:5px;
    margin-top:.5rem;
    background:#333;
    overflow:hidden;
  }
  .bar-fill {
    height:8px;
    width:0%;
    background:var(--good);
    transition:width .8s;
  }
  .src {
    border-top:1px solid #2f333b;
    margin-top:1rem;
    padding-top:.6rem;
    font-size:.9rem;
  }
  .src a {color:var(--good);text-decoration:none;}
  .src a:hover {text-decoration:underline;}
</style>
</head>
<body>
  <h1>Motor Coeziv 3.14Δ</h1>
  <p>Analiză factuală și semantică în timp real</p>
  <textarea id="input" placeholder="Ex: Ion Iliescu a murit"></textarea><br />
  <button id="analyzeBtn">Analizează informația</button>
  <div id="result" style="display:none;"></div>

<script>
const btn=document.getElementById("analyzeBtn");
const resDiv=document.getElementById("result");

btn.addEventListener("click",async()=>{
  const text=document.getElementById("input").value.trim();
  if(!text) return alert("Introdu o afirmație pentru analiză.");
  resDiv.style.display="block";
  resDiv.innerHTML="<p>⏳ Analiză în curs...</p>";

  try{
    const res=await fetch("/api/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text})});
    const data=await res.json();
    if(data.error) throw new Error(data.error);

    // determinăm culoarea barei după text
    let color="var(--mid)";
    if(/✅|adevăr|corect|factual|în viață/i.test(data.verdict)) color="var(--good)";
    if(/❌|fals|incorect|greșit/i.test(data.verdict)) color="var(--bad)";
    const scoreMatch=data.verdict.match(/([0-9]\.?[0-9]*)\s*\/\s*3\.?14/);
    const score=scoreMatch?parseFloat(scoreMatch[1]):2.0;
    const width=Math.min((score/3.14)*100,100);

    const sources=(data.sources||[]).slice(0,5).map(s=>`
      <div class="src">
        <a href="${s.link}" target="_blank">${s.title}</a><br/>
        <span style="color:#9ba1a6">${s.date||""}</span><br/>
        ${s.snippet||""}
      </div>
    `).join("");

    resDiv.innerHTML=`
      <p><strong>Verdict:</strong><br/>${data.verdict.replace(/\n/g,"<br/>")}</p>
      <div class="bar"><div class="bar-fill" style="background:${color};width:${width}%"></div></div>
      <p style="margin-top:1rem;color:#9ba1a6;">Surse: ${data.sourceCount}</p>
      ${sources}
    `;
  }catch(err){
    resDiv.innerHTML=`<p style="color:var(--bad)">❌ Eroare: ${err.message}</p>`;
  }
});
</script>
</body>
</html>
