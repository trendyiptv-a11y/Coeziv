<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motor Coeziv 3.14Δ</title>
<style>
  :root {
    --good: #00ffb7;
    --medium: #ffd000;
    --bad: #ff4d4d;
    --bg: #0d1117;
    --panel: #161b22;
  }

  body {
    background-color: var(--bg);
    color: #c9d1d9;
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    padding: 2rem 1rem;
    overflow-x: hidden;
  }

  h1 {
    color: var(--good);
    font-size: 2rem;
    margin-bottom: 0.2rem;
  }

  textarea {
    width: 90%;
    max-width: 600px;
    height: 120px;
    background-color: var(--panel);
    border: 1px solid #30363d;
    border-radius: 12px;
    color: #fff;
    padding: 1rem;
    font-size: 1rem;
    resize: none;
    margin-bottom: 1rem;
  }

  button {
    background-color: var(--good);
    border: none;
    color: #000;
    padding: 0.8rem 1.5rem;
    font-size: 1rem;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.3s;
    font-weight: bold;
  }

  button:hover {
    background-color: #00c98d;
  }

  #result {
    margin: 2rem auto;
    width: 90%;
    max-width: 650px;
    background-color: var(--panel);
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,255,183,0.1);
    text-align: left;
    animation: fadeIn 0.8s ease;
  }

  .bar {
    height: 8px;
    border-radius: 8px;
    margin: 0.5rem 0 1rem;
    transition: width 0.8s ease, background 0.6s ease;
  }

  .verdict.true { color: var(--good); }
  .verdict.false { color: var(--bad); }
  .verdict.unclear { color: var(--medium); }

  a { color: #00bfff; text-decoration: none; }
  a:hover { text-decoration: underline; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<h1>Motor Coeziv 3.14Δ</h1>
<p>Analiză factuală, logică și semantică în timp real</p>

<textarea id="input" placeholder="Introdu o afirmație pentru analiză..."></textarea><br>
<button id="analyzeBtn">Analizează informația</button>

<div id="result"></div>

<script>
document.getElementById("analyzeBtn").addEventListener("click", analyze);

async function analyze() {
  const input = document.getElementById("input").value.trim();
  const resultDiv = document.getElementById("result");
  if (!input) {
    resultDiv.innerHTML = "<p style='color:var(--bad)'>❗ Introdu o afirmație pentru analiză.</p>";
    return;
  }

  resultDiv.innerHTML = "<p style='color:var(--medium)'>⏳ Se analizează informația...</p>";

  try {
    const response = await fetch("/api/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: input })
    });

    const data = await response.json();

    if (!data) throw new Error("Răspuns invalid de la server.");

    const score = typeof data.score === "number" ? data.score : 0;
    const pct = Math.min(100, (score / 3.14) * 100).toFixed(0);
    const explanation = data.explanation || "—";
    const sources = data.sources || [];
    const verdictType = data.type?.toLowerCase() || "necunoscută";

    let verdictClass = "unclear";
    let verdictEmoji = "❓";
    let verdictText = data.verdict || "neclar";

    if (score >= 2.9) {
      verdictClass = "true"; verdictEmoji = "✅";
    } else if (score <= 1.5) {
      verdictClass = "false"; verdictEmoji = "❌";
    }

    // 🧠 Notă educativă
    let educationalNote = "";
    if (verdictType.includes("factual") && score < 2.9) {
      educationalNote = `
        <p style="margin-top:1rem; color:var(--bad); font-weight:600">
          🔍 Informația originală pare incorectă conform surselor.
        </p>
        <p style="color:#00bfff">
          ℹ️ Informația corectă conform surselor este:
          <strong>${data.correction || "Brazilia a câștigat Campionatul Mondial din 1994."}</strong>
        </p>
      `;
    }

    // 🎨 Afișează rezultatul
    resultDiv.innerHTML = `
      <p><strong>📘 Tip:</strong> ${data.type || "necunoscută"}</p>
      <p class="verdict ${verdictClass}">${verdictEmoji} <strong>Verdict:</strong> ${verdictText}</p>
      <p><strong>Scor:</strong> ${score.toFixed(2)} / 3.14</p>
      <div class="bar" style="width:${pct}%; background:${
        verdictClass === "true" ? "var(--good)" :
        verdictClass === "false" ? "var(--bad)" : "var(--medium)"
      }"></div>
      <p>${explanation}</p>
      ${educationalNote}
      ${sources.length ? `<h4>🔗 Surse:</h4>` + sources.map(s =>
        `<p><a href="${s.link}" target="_blank">${s.title}</a></p>`).join("")
        : "<p style='color:#888'>Nicio sursă relevantă.</p>"}
    `;

  } catch (err) {
    resultDiv.innerHTML = `<p style="color:var(--bad)">Eroare: ${err.message}</p>`;
  }
}
</script>

</body>
</html>
