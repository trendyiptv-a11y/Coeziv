<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coeziv 3.14Δ – Analizor Informațional</title>
  <style>
    :root {
      --bg: #0d1117;
      --panel: #161b22;
      --text: #c9d1d9;
      --accent: #00ffb7;
      --gray: #777;
      --green: #00ffb7;
      --yellow: #ffc800;
      --red: #ff0055;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: "Segoe UI", sans-serif;
      text-align: center;
      margin: 0;
      padding: 2rem 1rem;
    }

    h1 {
      color: var(--accent);
      font-size: 1.8rem;
    }

    textarea {
      width: 90%;
      max-width: 600px;
      height: 120px;
      background-color: var(--panel);
      color: var(--text);
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 0.8rem;
      font-size: 1rem;
      resize: none;
      outline: none;
    }

    button {
      background-color: var(--accent);
      color: #000;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      padding: 0.7rem 1.5rem;
      margin-top: 1rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      filter: brightness(1.2);
    }

    #result {
      max-width: 800px;
      background: var(--panel);
      margin: 2rem auto;
      padding: 1.5rem;
      border-radius: 16px;
      text-align: left;
      line-height: 1.5;
      font-size: 0.95rem;
      box-shadow: 0 0 10px #0006;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    footer {
      margin-top: 2rem;
      font-size: 0.8rem;
      color: #777;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <h1>🧠 Coeziv 3.14Δ</h1>
  <p>Analizor informațional – detectează nivelul de coeziune, vibrație și manipulare semantică.</p>

  <textarea id="textInput" placeholder="Scrie o afirmație pentru analiză..."></textarea><br>
  <button onclick="analyzeText()">🔍 Analizează Informația</button>

  <div id="result"></div>

  <footer>
    © 2025 Coeziv 3.14Δ – Verificare factuală triplă (semantic + factual + logic)
  </footer>

  <script>
    async function analyzeText() {
      const text = document.querySelector("#textInput").value.trim();
      const resultBox = document.querySelector("#result");

      if (!text) {
        resultBox.innerHTML = "⚠️ Introdu o afirmație pentru analiză.";
        return;
      }

      resultBox.innerHTML = "🔄 Analiză în curs...";

      try {
        const response = await fetch("/api/analyze-web", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text }),
        });

        const data = await response.json();
        const { analysis, confidence, sources } = data;

        let verdict = "";
        let verdictColor = "";

        // 🔍 regulă: fără minimum 3 surse → analiză suspendată
        if (!sources || sources.length < 3) {
          verdict = "⚠️ Analiză suspendată – insuficiente surse factuale (minim 3 necesare).";
          verdictColor = "#777";
        } else if (confidence < 40) {
          verdict = "🟢 Grad redus de manipulare – informație confirmată factual.";
          verdictColor = "#00ffb7";
        } else if (confidence < 70) {
          verdict = "🟡 Risc moderat – recomandăm verificare suplimentară.";
          verdictColor = "#ffc800";
        } else {
          verdict = "🔴 Grad ridicat de manipulare – necesită confirmare factuală.";
          verdictColor = "#ff0055";
        }

        // 🔗 afișare surse
        let sourcesHTML = sources
          .map((s) => `<li><a href="${s.url}" target="_blank">${s.title}</a></li>`)
          .join("");

        if (!sourcesHTML)
          sourcesHTML = "<li>Nicio sursă factuală relevantă găsită.</li>";

        resultBox.innerHTML = `
          <div style="border:2px solid ${verdictColor};border-radius:12px;padding:1rem;margin-top:1rem;">
            <strong style="color:${verdictColor}">${verdict}</strong><br>
            <small>Indice de încredere: ${confidence}%</small>
          </div>
          <p>${analysis}</p>
          <h4>🔍 Surse factuale:</h4>
          <ul>${sourcesHTML}</ul>
          <p><small>🧠 Analiză efectuată de Motorul Coeziv 3.14Δ – bazată pe date publice, web factual și verificare semantică autonomă.</small></p>
        `;
      } catch (err) {
        resultBox.innerHTML = "⚠️ Eroare la conexiunea cu motorul semantic.";
      }
    }
  </script>
</body>
</html>
