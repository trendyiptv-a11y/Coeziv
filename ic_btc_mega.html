<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mega-ciclul coeziv BTC – Model Coeziv</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #020617;
      --bg-soft: #050816;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-strong: #60a5fa;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --muted-soft: #6b7280;
      --border: #1f2937;
      --up: #22c55e;
      --down: #ef4444;
      --warn: #f59e0b;
      --radius-xl: 1.5rem;
      --radius-lg: 1.1rem;
      --radius-pill: 999px;
      --shadow-soft: 0 20px 60px rgba(0, 0, 0, 0.65);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-main);
      background:
        radial-gradient(circle at top, #0b1120 0, #020617 42%, #000 100%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    main.page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 1.7rem 1.2rem 2.8rem;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .top-back {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.85rem;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.9);
      font-size: 0.78rem;
      color: var(--muted);
      margin-bottom: 1.1rem;
    }

    .top-back span.icon {
      display: inline-flex;
      width: 0.55rem;
      height: 0.55rem;
      border-radius: 999px;
      background: var(--accent);
    }

    header.hero {
      margin-bottom: 1.6rem;
    }

    header.hero h1 {
      margin: 0 0 0.5rem;
      font-size: 1.7rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    header.hero p {
      margin: 0.1rem 0 0;
      font-size: 0.92rem;
      color: var(--muted);
      max-width: 44rem;
      line-height: 1.55;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
      margin-top: 0.9rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.8rem;
      border-radius: var(--radius-pill);
      font-size: 0.78rem;
      background: rgba(15, 23, 42, 0.88);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: var(--muted);
    }

    .pill-dot {
      width: 0.42rem;
      height: 0.42rem;
      border-radius: 999px;
      background: var(--accent);
    }

    .pill.cycle .pill-dot { background: #a855f7; }
    .pill.struct .pill-dot { background: #38bdf8; }
    .pill.flux .pill-dot { background: #22c55e; }

    section.cards-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1rem;
      margin-bottom: 1.4rem;
    }

    @media (max-width: 900px) {
      section.cards-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      position: relative;
      border-radius: var(--radius-xl);
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 40%),
        radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.9), #020617);
      padding: 1.1rem 1.1rem 1.25rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .card-mega {
      grid-column: 1 / -1;
      background:
        radial-gradient(circle at top, rgba(248, 250, 252, 0.05), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.22), transparent 60%),
        #020617;
      border: 1px solid rgba(56, 189, 248, 0.45);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.65rem;
      gap: 0.75rem;
    }

    .card-title {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted-soft);
      margin-bottom: 0.12rem;
    }

    .card-sub {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.27rem 0.8rem;
      border-radius: var(--radius-pill);
      font-size: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      white-space: nowrap;
    }

    .badge-dot {
      width: 0.44rem;
      height: 0.44rem;
      border-radius: 999px;
    }

    .badge.phase .badge-dot { background: #a855f7; }
    .badge.cooling .badge-dot { background: var(--warn); }
    .badge.stress .badge-dot { background: #ef4444; }
    .badge.strong .badge-dot { background: var(--up); }
    .badge.soft .badge-dot { background: var(--muted-soft); }

    .value-main {
      font-size: 2.1rem;
      font-weight: 650;
      color: #f9fafb;
      letter-spacing: 0.02em;
    }

    .value-suffix {
      font-size: 0.95rem;
      color: var(--muted);
      margin-left: 0.15rem;
    }

    .value-row {
      display: flex;
      align-items: baseline;
      gap: 0.35rem;
      margin-bottom: 0.2rem;
    }

    .card-mega .value-main {
      font-size: 2.3rem;
    }

    .meta-row {
      margin-top: 0.45rem;
      font-size: 0.78rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .meta-row strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    /* Sparkline */

    section.sparkline {
      margin-bottom: 1.6rem;
    }

    .sparkline-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted-soft);
      margin-bottom: 0.25rem;
    }

    .sparkline-sub {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.7rem;
    }

    .sparkline-wrapper {
      border-radius: 1.2rem;
      background: radial-gradient(circle at top, #020617, #020617 40%, #000);
      border: 1px solid #111827;
      overflow: hidden;
      padding: 0.75rem 0.75rem 0.9rem;
    }

    .sparkline-wrapper canvas {
      width: 100% !important;
      height: 220px !important;
    }

    /* Narrative */

    section.narrative {
      margin-top: 1.2rem;
      padding: 1.1rem 1.1rem 1.15rem;
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      background:
        radial-gradient(circle at top left, rgba(148, 163, 184, 0.14), transparent 55%),
        #020617;
      box-shadow: var(--shadow-soft);
      font-size: 0.86rem;
      color: var(--muted);
      line-height: 1.7;
    }

    section.narrative h2 {
      margin: 0 0 0.5rem;
      font-size: 0.98rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #e5e7eb;
    }

    section.narrative p {
      margin: 0.2rem 0;
    }

    section.narrative strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .error-box {
      margin-top: 0.75rem;
      padding: 0.65rem 0.8rem;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(248, 113, 113, 0.55);
      background: rgba(127, 29, 29, 0.35);
      color: #fecaca;
      font-size: 0.78rem;
      display: none;
    }

    footer.page-foot {
      margin-top: 2.2rem;
      font-size: 0.76rem;
      color: var(--muted-soft);
      line-height: 1.7;
    }

    footer.page-foot a {
      color: var(--accent-strong);
      text-decoration: none;
    }

    footer.page-foot a:hover {
      text-decoration: underline;
    }

    /* Timeline bloc – preluat și adaptat din versiunea ta anterioară */

    .mega-timeline {
      margin-top: 1.8rem;
      padding: 1.3rem 1.1rem 1.4rem;
      border-radius: 1.5rem;
      background: radial-gradient(circle at top, rgba(15,23,42,0.55), #020617);
      border: 1px solid rgba(55,65,81,0.9);
    }

    .mega-timeline h3 {
      margin: 0 0 0.6rem;
      font-size: 0.96rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .mega-timeline p.lead {
      margin: 0 0 0.7rem;
      font-size: 0.84rem;
      color: #9ca3af;
      max-width: 44rem;
      line-height: 1.5;
    }

    .mega-timeline-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.9rem;
    }

    @media (max-width: 900px) {
      .mega-timeline-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .timeline-step {
      border-radius: 1.3rem;
      padding: 0.8rem 0.85rem 0.9rem;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      position: relative;
      overflow: hidden;
    }

    .timeline-step::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(59,130,246,0.14), transparent 60%);
      opacity: 0.9;
      pointer-events: none;
    }

    .timeline-inner {
      position: relative;
      z-index: 1;
    }

    .timeline-era {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ca3af;
      margin-bottom: 0.2rem;
    }

    .timeline-title {
      font-size: 0.9rem;
      margin: 0 0 0.25rem;
      color: #e5e7eb;
    }

    .timeline-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      margin-bottom: 0.35rem;
    }

    .timeline-tag {
      font-size: 0.7rem;
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      background: rgba(15,23,42,0.9);
      color: #cbd5f5;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .timeline-text {
      margin: 0;
      font-size: 0.8rem;
      color: #d1d5db;
      line-height: 1.55;
    }

    .timeline-tag.baza { border-color: rgba(34,197,94,0.6); }
    .timeline-tag.bull { border-color: rgba(56,189,248,0.7); }
    .timeline-tag.bear { border-color: rgba(248,113,113,0.7); }
    .timeline-tag.reset { border-color: rgba(251,191,36,0.7); }
    .timeline-tag.curent { border-color: rgba(129,140,248,0.9); }

  </style>
</head>
<body>
  <main class="page">
    <a href="ic_btc.html" class="top-back">
      <span class="icon"></span>
      <span>Înapoi la indicele IC_BTC</span>
    </a>

    <header class="hero">
      <h1>Mega-ciclul coeziv BTC</h1>
      <p>
        Privire macro asupra pieței Bitcoin din 2010 până azi, în Modelul Coeziv.
        Pagina îți arată <strong>unde ne aflăm acum</strong> în mega-ciclul structural,
        bazat pe indicii <strong>IC_BTC</strong> (structural), <strong>ICD_BTC</strong>
        (direcțional), <strong>ICF_BTC</strong> (flux) și <strong>ICC_BTC</strong> (ciclu).
      </p>

      <div class="pill-row">
        <div class="pill cycle">
          <span class="pill-dot"></span>
          <span>ICC_BTC – mega-ciclu post-2014</span>
        </div>
        <div class="pill struct">
          <span class="pill-dot"></span>
          <span>IC_BTC – structură &amp; trend de fond</span>
        </div>
        <div class="pill flux">
          <span class="pill-dot"></span>
          <span>ICF_BTC – flux &amp; stres sistemic</span>
        </div>
      </div>
    </header>

    <!-- CARDURI PRINCIPALE -->
    <section class="cards-grid">
      <!-- Scor compus mega-ciclu -->
      <article class="card card-mega">
        <div class="card-header">
          <div>
            <div class="card-title">Scor mega-ciclu coeziv (0–100)</div>
            <div class="card-sub">
              Combinație între <strong>ciclu</strong>, <strong>structură</strong> și <strong>flux</strong>
              (ferestră internă a modelului).
            </div>
          </div>
          <div class="badge phase" id="megaScoreBadge">
            <span class="badge-dot"></span>
            <span id="megaScoreLabel">se încarcă...</span>
          </div>
        </div>

        <div class="value-row">
          <div class="value-main" id="megaScoreValue">–</div>
          <div class="value-suffix">/100</div>
        </div>

        <div class="meta-row" id="megaScoreText">
          Scorul se calculează după încărcarea datelor.
        </div>
      </article>

      <!-- ICC_BTC CICLU -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">ICC_BTC CICLU (0–100)</div>
            <div class="card-sub">
              Poziționare în mega-ciclu: baze, expansiune, distribuție, reset.
            </div>
          </div>
          <div class="badge phase" id="iccBadge">
            <span class="badge-dot"></span>
            <span id="iccPhaseLabel">fază necunoscută</span>
          </div>
        </div>

        <div class="value-row">
          <div class="value-main" id="iccValue">–</div>
          <div class="value-suffix">/100</div>
        </div>

        <div class="meta-row" id="iccText">
          Se încarcă interpretarea fazei de ciclu…
        </div>
      </article>

      <!-- IC_BTC STRUCTURAL -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">IC_BTC STRUCTURAL (0–100)</div>
            <div class="card-sub">
              Regim structural: trend vs flux total, volatilitate relativă.
            </div>
          </div>
          <div class="badge cooling" id="structBadge">
            <span class="badge-dot"></span>
            <span id="structLabel">–</span>
          </div>
        </div>

        <div class="value-row">
          <div class="value-main" id="icStructValue">–</div>
          <div class="value-suffix">/100</div>
        </div>

        <div class="meta-row" id="icStructText">
          Se încarcă interpretarea regimului structural…
        </div>
      </article>

      <!-- ICF_BTC FLUX -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">ICF_BTC FLUX (0–100)</div>
            <div class="card-sub">
              Flux &amp; tensiune: cât de stresată sau calmă e piața.
            </div>
          </div>
          <div class="badge stress" id="fluxBadge">
            <span class="badge-dot"></span>
            <span id="fluxLabel">–</span>
          </div>
        </div>

        <div class="value-row">
          <div class="value-main" id="fluxValue">–</div>
          <div class="value-suffix">/100</div>
        </div>

        <div class="meta-row" id="fluxText">
          Se încarcă interpretarea fluxului…
        </div>
      </article>
    </section>

    <!-- SPARKLINE ICC_BTC – ULTIMII 10+ ANI -->
    <section class="sparkline">
      <div class="sparkline-title">
        ICC_BTC ciclu – ultimele ~10+ ani (0–100)
      </div>
      <div class="sparkline-sub">
        Linia arată drumul mega-ciclului în ultimul deceniu. Culorile segmentelor
        marchează fazele: baze (albastru închis), acumulare / recovery (verde),
        fază intermediară (mov), distribuție avansată (galben), zone extreme (roșu).
      </div>
      <div class="sparkline-wrapper">
        <canvas id="iccSparkline"></canvas>
      </div>
    </section>

    <!-- NARATIV MEGA-CICLU -->
    <section class="narrative" id="megaNarrative">
      <h2>Unde suntem acum în mega-ciclu?</h2>
      <p>Se încarcă interpretarea pe baza datelor din <code>data/ic_btc_series.json</code>…</p>
    </section>

    <!-- TIMELINE ISTORIC COEZIV -->
    <section class="mega-timeline">
      <h3>Timeline mega-ciclu (interpretare Coeziv, 2010–2025)</h3>
      <p class="lead">
        Mai jos este un rezumat conceptual, aliniat cu ciclurile clasice BTC,
        dar exprimat în limbajul Modelului Coeziv (bază, expansiune, top,
        resetare). Nu sunt maxime/minime de preț, ci faze structurale.
      </p>

      <div class="mega-timeline-grid">
        <article class="timeline-step">
          <div class="timeline-inner">
            <div class="timeline-era">2010–2013</div>
            <h4 class="timeline-title">Baze timpurii &amp; adopție incipientă</h4>
            <div class="timeline-tag-row">
              <span class="timeline-tag baza">bază</span>
            </div>
            <p class="timeline-text">
              Structură de piață imatură, lichiditate redusă și volatilitate
              extremă. În limbaj Coeziv, aceasta este zona de <strong>bază
              istorică</strong> a mega-ciclului, în care ICC_BTC marchează
              începutul arcului structural post-Genesis.
            </p>
          </div>
        </article>

        <article class="timeline-step">
          <div class="timeline-inner">
            <div class="timeline-era">2014–2017</div>
            <h4 class="timeline-title">Bază post-2014 &amp; expansiune majoră</h4>
            <div class="timeline-tag-row">
              <span class="timeline-tag baza">bază</span>
              <span class="timeline-tag bull">expansiune</span>
            </div>
            <p class="timeline-text">
              După corecția severă 2014–2015, structura IC_BTC intră într-o
              <strong>bază coezivă</strong>, urmată de un ciclu de expansiune
              puternică până în topul 2017. ICC_BTC mută mega-ciclul din zona
              de bază în zona de <strong>expansiune avansată</strong>.
            </p>
          </div>
        </article>

        <article class="timeline-step">
          <div class="timeline-inner">
            <div class="timeline-era">2018–2019</div>
            <h4 class="timeline-title">Resetare &amp; realiniere structurală</h4>
            <div class="timeline-tag-row">
              <span class="timeline-tag bear">bear</span>
              <span class="timeline-tag reset">reset</span>
            </div>
            <p class="timeline-text">
              Bear marketul de după 2017 aduce o <strong>răcire severă</strong>
              în IC_BTC și episoade de stres în ICF_BTC. Din perspectiva
              mega-ciclului, perioada este o <strong>resetare de trend</strong>,
              nu începutul unui nou mega-ciclu.
            </p>
          </div>
        </article>

        <article class="timeline-step">
          <div class="timeline-inner">
            <div class="timeline-era">2020–2021</div>
            <h4 class="timeline-title">Expansiune parabolică &amp; top structural</h4>
            <div class="timeline-tag-row">
              <span class="timeline-tag bull">bull</span>
              <span class="timeline-tag reset">top structural</span>
            </div>
            <p class="timeline-text">
              Combinația dintre IC_BTC foarte ridicat, ICD_BTC bullish și
              episoade de stres în ICF_BTC corespunde unei faze de
              <strong>expansiune parabolică</strong> a mega-ciclului, în care
              ICC_BTC se apropie de zona de top (valori înalte, 70–90+).
            </p>
          </div>
        </article>

        <article class="timeline-step">
          <div class="timeline-inner">
            <div class="timeline-era">2022–2023</div>
            <h4 class="timeline-title">Resetare post-euforie &amp; reconstrucție</h4>
            <div class="timeline-tag-row">
              <span class="timeline-tag bear">bear</span>
              <span class="timeline-tag reset">reechilibrare</span>
            </div>
            <p class="timeline-text">
              Corecția amplă de după 2021 este văzută de Modelul Coeziv ca o
              fază de <strong>reechilibrare structurală</strong>: IC_BTC se
              răcește, ICF_BTC marchează episoade de stres, iar ICC_BTC coboară
              din zona de top spre o <strong>fază intermediară</strong>.
            </p>
          </div>
        </article>

        <article class="timeline-step">
          <div class="timeline-inner">
            <div class="timeline-era">2024–2025+</div>
            <h4 class="timeline-title">Faza curentă: bull târziu / intermediar</h4>
            <div class="timeline-tag-row">
              <span class="timeline-tag curent">stare curentă</span>
            </div>
            <p class="timeline-text">
              Valorile curente din ICC_BTC indică, în mare, o
              <strong>fază intermediară</strong> a mega-ciclului post-2014:
              nu la bază, dar nici la maximul istoric al topurilor. Structura
              este în răcire, iar fluxul rămâne sensibil, ceea ce sugerează că
              următorii ani pot fi o combinație de redistribuție,
              consolidare și, mai târziu, construcția bazei următorului ciclu.
            </p>
          </div>
        </article>

        <!-- Card: Extensia 80k → 120k NU este bull market nou -->
<article class="card">
  <div class="card-header">
    <div>
      <div class="card-title">
        Extensia 80.000 → 120.000 USD
      </div>
      <div class="card-sub">
        De ce modelul Coeziv NU o tratează ca pe un nou bull market.
      </div>
    </div>
    <div class="badge stress">
      <span class="badge-dot"></span>
      <span>extensie speculativă</span>
    </div>
  </div>

  <div class="meta-row">
    <p style="margin:0 0 0.4rem;">
      Creșterea către <strong>120.000 USD</strong> nu a fost confirmată de
      structura internă a pieței. Indicii Coeziv au semnalat
      <strong>pierdere de coeziune</strong>, <strong>flux tensionat</strong>
      și <strong>ciclu în fază avansată</strong> – tipice extensiilor finale,
      nu unui bull market sănătos.
    </p>
    <p style="margin:0 0 0.4rem;">
      Zona este caracterizată istoric de:
      volatilitate anormală, lichiditate redusă, levier exagerat și
      short-squeeze-uri în cascadă. Prețul a urcat, dar
      <strong>fundamentul structural nu a susținut mișcarea</strong>.
    </p>
    <p style="margin:0;">
      În termeni simpli: a fost o
      <strong>extensie speculativă (final blow-off)</strong> a ciclului
      ascendent 2023–2024, nu începutul unui nou bull market.
    </p>
  </div>
</article>
      </div>
    </section>

    <div class="error-box" id="errorBox"></div>

    <footer class="page-foot">
      Modelul Coeziv BTC este un framework experimental, nu o recomandare de
      investiții. Interpretarea de mai sus este structurală și poate fi folosită
      doar împreună cu propriul management de risc. Pentru detalii tehnice,
      vezi fișierele din <code>data/</code> și script-urile Python din
      repository-ul GitHub.
    </footer>
  </main>

  <script>
    function clamp(x, min, max) {
      return Math.min(max, Math.max(min, x));
    }

    function safeNumber(v) {
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    function showError(msg) {
      const box = document.getElementById("errorBox");
      box.textContent = msg;
      box.style.display = "block";
      console.error("[Mega BTC]", msg);
    }

    async function fetchJsonSafe(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("Nu pot încărca " + url + " (" + res.status + ")");
      return res.json();
    }

    // Clasificări simple pentru text

    function classifyCycle(v) {
      if (v == null || !Number.isFinite(v)) {
        return {
          label: "fază necunoscută",
          text: "Nu am putut determina faza de mega-ciclu."
        };
      }
      if (v < 20) {
        return {
          label: "bază profundă",
          text: "Zonă tipică pentru baze profunde sau capitulări majore."
        };
      } else if (v < 40) {
        return {
          label: "acumulare / recovery",
          text: "Fază de reconstrucție după bear: acumulare și început de expansiune."
        };
      } else if (v < 60) {
        return {
          label: "fază intermediară",
          text: "Suntem într-o fază intermediară a mega-ciclului: între expansiune și început de distribuție."
        };
      } else if (v < 80) {
        return {
          label: "distribuție avansată",
          text: "Zona tipică pentru faze de top structural, redistribuție și volatilitate mai nervoasă."
        };
      }
      return {
        label: "extremă / final de ciclu",
        text: "Zona cu risc ridicat de final de ciclu: euforie sau capitulări rapide."
      };
    }

    function classifyStruct(v) {
      if (v == null || !Number.isFinite(v)) {
        return {
          label: "necunoscut",
          text: "Structura nu a putut fi evaluată."
        };
      }
      if (v < 25) {
        return {
          label: "foarte slab",
          text: "Structură foarte slabă – trendul de fond este în răcire, tipic pentru baze adânci sau tranziții de ciclu."
        };
      } else if (v < 45) {
        return {
          label: "în răcire",
          text: "Structură în răcire – trendul își pierde coeziunea, cu risc de tranziție spre faze bear / redistribuție."
        };
      } else if (v < 65) {
        return {
          label: "mediu",
          text: "Structură medie – nici bull clar, nici bear clar; piața poate oscila între sub-cicluri bull și bear."
        };
      } else if (v < 85) {
        return {
          label: "puternic",
          text: "Regim structural puternic – trendul dominant este clar și bine susținut de flux."
        };
      }
      return {
        label: "extrem",
        text: "Structură extrem de puternică – zone unde piața poate deveni supra-încinsă și vulnerabilă la resetări."
      };
    }

    function classifyFlux(v) {
      if (v == null || !Number.isFinite(v)) {
        return {
          label: "necunoscut",
          text: "Nu am putut evalua fluxul și tensiunea pieței."
        };
      }
      if (v < 25) {
        return {
          label: "calm",
          text: "Volatilitate relativ scăzută – flux calm sau perioade de consolidare prelungită."
        };
      } else if (v < 50) {
        return {
          label: "flux mixt",
          text: "Flux mixt – alternanță între episoade calme și spike-uri de stres, fără o tensiune sistemică clară."
        };
      } else if (v < 75) {
        return {
          label: "stres ridicat",
          text: "Nivel ridicat de stres – mișcări mai bruște, lichiditate mai sensibilă, context tipic pentru resetări locale."
        };
      }
      return {
        label: "stres sistemic",
        text: "Stres sistemic – valori care istoric au apărut înaintea resetărilor mari de mega-ciclu sau a capitulărilor majore."
      };
    }

    function classifyMegaScore(v) {
      if (v == null || !Number.isFinite(v)) {
        return {
          label: "necunoscut",
          text: "Nu am putut calcula scorul compus de mega-ciclu."
        };
      }
      if (v < 25) {
        return {
          label: "zonă de bază / reset",
          text: "Scor redus – combinație între ciclu jos, structură slăbită și stres mare. Istoric, astfel de zone coincid adesea cu baze de mega-ciclu sau cu resetări profunde."
        };
      } else if (v < 45) {
        return {
          label: "reconstrucție",
          text: "Zona de reconstrucție: pieței îi ia timp să refacă structura după un bear puternic sau după resetări masive."
        };
      } else if (v < 65) {
        return {
          label: "fază intermediară",
          text: "Scor intermediar – piața nu mai este în bază, dar nici în euforie de top. Mișcările pot alterna între sub-cicluri bull și bear."
        };
      } else if (v < 80) {
        return {
          label: "distribuție avansată",
          text: "Scor ridicat – structură încă solidă, ciclu avansat și, de regulă, stres în creștere. Perioadă tipică de redistribuție după un bull extins."
        };
      }
      return {
        label: "zonă extremă",
        text: "Scor foarte ridicat – regiune în care istoric s-au concentrat maximele de ciclu și episoadele de euforie extremă."
      };
    }

    let iccChart = null;

    function buildIccSparkline(points) {
      const ctx = document.getElementById("iccSparkline").getContext("2d");
      if (iccChart) iccChart.destroy();

      const labels = points.map(p => p.label);
      const data = points.map(p => p.v);

      iccChart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "ICC_BTC ciclu (0–100)",
            data,
            tension: 0.18,
            pointRadius: 0,
            borderWidth: 2,
            fill: true,
            segment: {
              borderColor: ctx => {
                const y = ctx.p0.parsed.y;
                if (y < 20) return "#1d4ed8";
                if (y < 40) return "#22c55e";
                if (y < 60) return "#a855f7";
                if (y < 80) return "#f59e0b";
                return "#ef4444";
              },
              backgroundColor: ctx => {
                const y = ctx.p0.parsed.y;
                if (y < 20) return "rgba(37, 99, 235, 0.18)";
                if (y < 40) return "rgba(34, 197, 94, 0.18)";
                if (y < 60) return "rgba(168, 85, 247, 0.18)";
                if (y < 80) return "rgba(245, 158, 11, 0.18)";
                return "rgba(239, 68, 68, 0.18)";
              }
            }
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              mode: "index",
              intersect: false,
              callbacks: {
                label: ctx => " ICC_BTC: " + ctx.parsed.y.toFixed(2)
              }
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: {
                maxTicksLimit: 8,
                color: "#6b7280",
                font: { size: 10 }
              }
            },
            y: {
              min: 0,
              max: 100,
              ticks: {
                stepSize: 20,
                color: "#6b7280",
                font: { size: 10 }
              },
              grid: {
                color: "rgba(31,41,55,0.5)",
                drawBorder: false
              }
            }
          }
        }
      });
    }

    function buildNarrative(icc, icStruct, flux, megaScore, cycleCls, structCls, fluxCls, megaCls, asOf) {
      const box = document.getElementById("megaNarrative");
      const dateText = asOf ? String(asOf) : "ultima zi disponibilă";

      const html = `
        <h2>Unde suntem acum în mega-ciclu?</h2>
        <p>
          Pe baza datelor Coeziv BTC (snapshot la <strong>${dateText}</strong>),
          mega-ciclul poziționează Bitcoin într-o
          <strong>${cycleCls.label}</strong> cu un scor compus de
          mega-ciclu de aproximativ <strong>${megaScore.toFixed(1)}/100</strong>.
        </p>
        <p>
          <strong>ICC_BTC ciclu:</strong> ${icc.toFixed(2)}/100 – ${cycleCls.text}
        </p>
        <p>
          <strong>IC_BTC structural:</strong> ${icStruct.toFixed(2)}/100 – ${structCls.text}
        </p>
        <p>
          <strong>ICF_BTC flux:</strong> ${flux.toFixed(2)}/100 – ${fluxCls.text}
        </p>
        <p>
          <strong>Scor mega-ciclu:</strong> ${megaCls.text}
        </p>
        <p>
          În termeni simpli, suntem într-o fază în care piața nu mai este într-o bază
          adâncă, dar nici nu mai are structura coerentă a unui bull timpuriu. Următorii
          ani pot însemna o combinație între episoade de redistribuție, perioade de
          consolidare și, mai târziu, resetări mai profunde care pot ancora baza
          următorului mega-ciclu.
        </p>
      `;

      box.innerHTML = html;
    }

    async function main() {
      try {
        const data = await fetchJsonSafe("data/ic_btc_series.json");
        const series = Array.isArray(data.series) ? data.series : [];

        if (!series.length) {
          throw new Error("Seria din data/ic_btc_series.json este goală.");
        }

        const last = series[series.length - 1];

        const icc = safeNumber(last.ic_cycle ?? last.icc ?? last.icc_btc);
        const icStruct = safeNumber(last.ic_struct ?? last.ic_btc ?? last.ic);
        const flux = safeNumber(last.ic_flux ?? last.icf_btc ?? last.flux);
        const asOf = data.meta?.as_of ?? last.as_of ?? last.date ?? null;

        // scor compus (1A)
        const megaScoreRaw =
          0.5 * (icc ?? 0) +
          0.3 * ((icStruct != null) ? (100 - icStruct) : 0) +
          0.2 * (flux ?? 0);

        const megaScore = clamp(megaScoreRaw, 0, 100);

        const cycleCls = classifyCycle(icc);
        const structCls = classifyStruct(icStruct);
        const fluxCls = classifyFlux(flux);
        const megaCls = classifyMegaScore(megaScore);

        // Populate cards
        if (icc != null) {
          document.getElementById("iccValue").textContent = icc.toFixed(2);
        }
        document.getElementById("iccPhaseLabel").textContent = cycleCls.label;
        document.getElementById("iccText").textContent = cycleCls.text;

        if (icStruct != null) {
          document.getElementById("icStructValue").textContent = icStruct.toFixed(2);
        }
        document.getElementById("structLabel").textContent = structCls.label;
        document.getElementById("icStructText").textContent = structCls.text;

        if (flux != null) {
          document.getElementById("fluxValue").textContent = flux.toFixed(2);
        }
        document.getElementById("fluxLabel").textContent = fluxCls.label;
        document.getElementById("fluxText").textContent = fluxCls.text;

        document.getElementById("megaScoreValue").textContent = megaScore.toFixed(1);
        document.getElementById("megaScoreLabel").textContent = megaCls.label;
        document.getElementById("megaScoreText").textContent = megaCls.text;

        // Sparkline – ultimii ~10 ani
        const mapped = series
          .map(p => {
            const t = p.t ?? p.time ?? p.timestamp ?? p.date;
            const v = safeNumber(p.ic_cycle ?? p.icc ?? p.icc_btc);
            if (!Number.isFinite(v) || t == null) return null;

            let ts = Number(t);
            if (!Number.isFinite(ts)) return null;
            if (String(t).length <= 10) {
              // probabil secunde
              ts = ts * 1000;
            }

            return { ts, v };
          })
          .filter(Boolean)
          .sort((a, b) => a.ts - b.ts);

        if (mapped.length > 20) {
          const lastTs = mapped[mapped.length - 1].ts;
          const tenYearsMs = 10 * 365 * 24 * 60 * 60 * 1000;
          const cutoff = lastTs - tenYearsMs;

          const filtered = mapped.filter(p => p.ts >= cutoff);

          const step = Math.max(1, Math.floor(filtered.length / 400));
          const sampled = filtered.filter((_, idx) => idx % step === 0);

          const points = sampled.map(p => {
            const d = new Date(p.ts);
            const label = d.getUTCFullYear().toString();
            return { label, v: p.v };
          });

          if (points.length >= 2) {
            buildIccSparkline(points);
          }
        }

        // Narativ
        if (icc != null && icStruct != null && flux != null) {
          buildNarrative(icc, icStruct, flux, megaScore, cycleCls, structCls, fluxCls, megaCls, asOf);
        }

      } catch (err) {
        console.error(err);
        showError(
          "A apărut o eroare la încărcarea datelor pentru mega-ciclu. " +
          "Verifică existența fișierului data/ic_btc_series.json sau încearcă din nou."
        );
      }
    }

    main();
  </script>
</body>
</html>
