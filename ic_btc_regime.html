<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Regim Coeziv BTC – Modelul Coeziv</title>

  <style>
    :root {
      --bg: #050816;
      --card: #0b1020;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --bull: #22c55e;
      --bull-soft: rgba(34, 197, 94, 0.16);
      --bear: #ef4444;
      --bear-soft: rgba(239, 68, 68, 0.16);
      --mixed: #eab308;
      --mixed-soft: rgba(234, 179, 8, 0.18);
      --neutral: #60a5fa;
      --neutral-soft: rgba(96, 165, 250, 0.16);
      --radius-xl: 1.5rem;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #020617);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    main.page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 1.75rem 1.2rem 2.75rem;
    }

    header.hero {
      margin-bottom: 1.5rem;
    }

    header.hero h1 {
      margin: 0 0 0.6rem;
      font-size: 1.8rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    header.hero p {
      margin: 0;
      font-size: 0.92rem;
      color: var(--muted);
      max-width: 42rem;
      line-height: 1.6;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.75rem;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.35);
      font-size: 0.8rem;
      color: var(--muted);
      text-decoration: none;
      margin-bottom: 0.75rem;
    }

    .back-link span.icon {
      font-size: 1rem;
      transform: translateY(-1px);
    }

    .layout {
      display: grid;
      gap: 1.25rem;
      grid-template-columns: minmax(0, 1.35fr) minmax(0, 1fr);
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at top left, #020617, #020617 35%, #020617);
      border: 1px solid var(--border);
      padding: 1.3rem 1.25rem 1.35rem;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0% -20%, rgba(59,130,246,0.2), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }

    .card-sub {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.8rem;
    }

    /* Regim mare central */

    .regime-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.9rem;
      border-radius: var(--radius-pill);
      font-size: 0.8rem;
      margin-bottom: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.75);
      color: var(--muted);
    }

    .regime-dot {
      width: 0.55rem;
      height: 0.55rem;
      border-radius: 999px;
      background: var(--neutral);
    }

    .regime-dot.bull {
      background: var(--bull);
    }

    .regime-dot.bear {
      background: var(--bear);
    }

    .regime-dot.mixed {
      background: var(--mixed);
    }

    .regime-dot.neutral {
      background: var(--neutral);
    }

    .regime-label-main {
      font-size: 1.6rem;
      font-weight: 650;
      margin: 0.1rem 0 0.4rem;
    }

    .regime-label-secondary {
      font-size: 0.9rem;
      color: var(--muted);
      margin: 0;
    }

    .regime-banner {
      border-radius: 1.2rem;
      padding: 1.0rem 1.0rem;
      margin-top: 0.7rem;
      margin-bottom: 0.8rem;
      border: 1px solid rgba(148,163,184,0.25);
      background: radial-gradient(circle at top left, rgba(96,165,250,0.15), rgba(15,23,42,0.95));
    }

    .regime-banner.bull {
      border-color: var(--bull-soft);
      background: radial-gradient(circle at top left, var(--bull-soft), #020617);
    }

    .regime-banner.bear {
      border-color: var(--bear-soft);
      background: radial-gradient(circle at top left, var(--bear-soft), #020617);
    }

    .regime-banner.mixed {
      border-color: var(--mixed-soft);
      background: radial-gradient(circle at top left, var(--mixed-soft), #020617);
    }

    .regime-banner.neutral {
      border-color: var(--neutral-soft);
      background: radial-gradient(circle at top left, var(--neutral-soft), #020617);
    }

    .regime-banner-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 0.2rem;
      color: #e5e7eb;
    }

    .regime-banner-text {
      font-size: 0.86rem;
      color: var(--muted);
      line-height: 1.6;
    }

    /* Metrici IC */

    .metrics {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 0.75rem;
      margin-top: 0.4rem;
    }

    @media (max-width: 600px) {
      .metrics {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .metric-card {
      border-radius: 1rem;
      padding: 0.7rem 0.8rem 0.75rem;
      background: rgba(15,23,42,0.9);
      border: 1px solid var(--border);
    }

    .metric-label {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: #9ca3af;
      margin-bottom: 0.15rem;
    }

    .metric-value-row {
      display: flex;
      align-items: baseline;
      gap: 0.3rem;
      margin-bottom: 0.4rem;
    }

    .metric-value-main {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .metric-value-unit {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .metric-bar {
      position: relative;
      width: 100%;
      height: 0.45rem;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      border: 1px solid rgba(15,23,42,0.9);
    }

    .metric-bar-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      transition: width 0.6s ease;
    }

    .metric-bar-fill.struct {
      background: linear-gradient(90deg, var(--neutral-soft), var(--neutral));
    }

    .metric-bar-fill.dir.bull {
      background: linear-gradient(90deg, var(--bull-soft), var(--bull));
    }

    .metric-bar-fill.dir.bear {
      background: linear-gradient(90deg, var(--bear-soft), var(--bear));
    }

    .metric-bar-fill.dir.neutral {
      background: linear-gradient(90deg, var(--mixed-soft), var(--mixed));
    }

    .metric-caption {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.35rem;
    }

    /* Context scurt */

    .context-list {
      list-style: none;
      padding: 0;
      margin: 0.4rem 0 0;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .context-list li {
      margin-bottom: 0.25rem;
    }

    .context-label {
      color: #9ca3af;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 0.2rem;
    }

    .badge-small {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.6rem;
      border-radius: var(--radius-pill);
      font-size: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
    }

    .badge-dot {
      width: 0.42rem;
      height: 0.42rem;
      border-radius: 999px;
      background: var(--neutral);
    }

    .badge-dot.up { background: var(--bull); }
    .badge-dot.down { background: var(--bear); }
    .badge-dot.mixed { background: var(--mixed); }

    .error-box {
      margin-top: 0.8rem;
      font-size: 0.78rem;
      padding: 0.6rem 0.8rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(248,113,113,0.7);
      background: rgba(127,29,29,0.22);
      color: #fecaca;
      display: none;
    }
  </style>
</head>
<body>
  <main class="page">
    <a href="ic_btc_prob.html" class="back-link">
      <span class="icon">←</span>
      <span>Înapoi la probabilități BTC</span>
    </a>

    <header class="hero">
      <h1>Regimul Coeziv BTC</h1>
      <p>
        Vizualizare dedicată pentru <strong>regimul coeziv</strong> al Bitcoin: IC_BTC structural,
        ICD_BTC direcțional și eticheta de regim curent.
      </p>
    </header>

    <section class="layout">
      <!-- Card regim mare -->
      <article class="card">
        <div class="card-inner">
          <div class="card-title">Regim coeziv actual BTC</div>
          <div class="card-sub">
            Ultima zi: <span id="lastDate">–</span>
          </div>

          <div class="regime-chip">
            <span id="regimeDot" class="regime-dot neutral"></span>
            <span id="regimeShort">–</span>
          </div>

          <h2 class="regime-label-main" id="regimeLabel">–</h2>
          <p class="regime-label-secondary" id="regimeSecondary">Se încarcă interpretarea...</p>

          <div id="regimeBanner" class="regime-banner neutral">
            <div class="regime-banner-title">Interpretare coezivă a regimului</div>
            <p class="regime-banner-text" id="regimeExplanation">
              Modelul așteaptă datele din structura BTC pentru a putea descrie regimul curent.
            </p>
          </div>

          <div class="error-box" id="errorBox"></div>
        </div>
      </article>

      <!-- Card metrici IC -->
      <article class="card">
        <div class="card-inner">
          <div class="card-title">Structură &amp; direcționalitate BTC</div>
          <div class="card-sub">
            Cum vede modelul coeziv starea internă a pieței: cât de coerent este trendul
            și cât de aliniate sunt mișcările zilnice cu direcția dominantă.
          </div>

          <div class="metrics">
            <div class="metric-card">
              <div class="metric-label">IC_BTC structural</div>
              <div class="metric-value-row">
                <span id="icStructVal" class="metric-value-main">–</span>
                <span class="metric-value-unit">/ 100</span>
              </div>
              <div class="metric-bar">
                <div id="icStructBar" class="metric-bar-fill struct"></div>
              </div>
              <div class="metric-caption">
                Cât de coerent este <strong>trendul structural</strong> (0 = haos, 100 = trend extrem de clar).
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-label">ICD_BTC direcțional</div>
              <div class="metric-value-row">
                <span id="icDirVal" class="metric-value-main">–</span>
                <span class="metric-value-unit">/ 100</span>
              </div>
              <div class="metric-bar">
                <div id="icDirBar" class="metric-bar-fill dir neutral"></div>
              </div>
              <div class="metric-caption">
                <strong>&gt; 50</strong> înclină spre bull, <strong>&lt; 50</strong> spre bear;
                valori apropiate de 50 indică o direcție mai puțin clară.
              </div>
            </div>
          </div>

          <div style="margin-top: 0.85rem;">
            <div class="context-label">Context scurt (din backend)</div>
            <ul class="context-list">
              <li>
                <span class="badge-small">
                  <span class="badge-dot up"></span>
                  <span id="contextTrend">Trend: –</span>
                </span>
              </li>
              <li>
                <span class="badge-small">
                  <span class="badge-dot mixed"></span>
                  <span id="contextVol">Volatilitate relativă: –</span>
                </span>
              </li>
              <li>
                <span class="badge-small">
                  <span class="badge-dot down"></span>
                  <span id="contextMacro">Macro (scurt): –</span>
                </span>
              </li>
            </ul>
          </div>
        </div>
      </article>
    </section>
  </main>

  <script>
    function clamp(x, min, max) {
      return Math.min(max, Math.max(min, x));
    }

    function safeNum(v) {
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    function showError(msg) {
      const box = document.getElementById("errorBox");
      if (!box) return;
      box.style.display = "block";
      box.textContent = msg;
      console.error("[Regim BTC]", msg);
    }

    async function main() {
      try {
        // Ajustează path-ul dacă JSON-ul nu este în /data/
        const res = await fetch("data/btc_state_latest.json?ts=" + Date.now(), {
          cache: "no-store",
        });
        if (!res.ok) {
          throw new Error("Nu pot încărca btc_state_latest.json (" + res.status + ")");
        }
        const btcState = await res.json();

        // ----- Date de bază -----
        const asOf =
          btcState.as_of ||
          btcState.date ||
          btcState.last_date ||
          "–";

        const icStruct =
          safeNum(btcState.ic_struct) ??
          safeNum(btcState.ic_structural);

        const icDir =
          safeNum(btcState.ic_dir) ??
          safeNum(btcState.ic_directional);

        const regimeCode  = btcState.regime_code  || null;
        const regimeLabel = btcState.regime_label || null;
        const regimeShort = btcState.regime_short || null;
        const regimeColor = btcState.regime_color || null;

        const ctxShort = btcState.context_short || {};
        const ctxTrend = ctxShort.trend && ctxShort.trend.text
          ? ctxShort.trend.text
          : null;
        const ctxVol = ctxShort.volatility && ctxShort.volatility.text
          ? ctxShort.volatility.text
          : null;
        const ctxMacro = ctxShort.macro && ctxShort.macro.text
          ? ctxShort.macro.text
          : null;

        // ----- Populare UI: data -----
        const lastDateEl = document.getElementById("lastDate");
        if (lastDateEl) {
          lastDateEl.textContent = asOf;
        }

        // ----- Regim oficial -----
        const regimeShortEl = document.getElementById("regimeShort");
        const regimeLabelEl = document.getElementById("regimeLabel");
        const regimeSecondaryEl = document.getElementById("regimeSecondary");
        const regimeExplanationEl = document.getElementById("regimeExplanation");
        const regimeDotEl = document.getElementById("regimeDot");
        const regimeBannerEl = document.getElementById("regimeBanner");

        const displayShort =
          regimeShort || regimeCode || "Regim Coeziv BTC";
        const displayLabel =
          regimeLabel || "Regim Coeziv Bitcoin";

        if (regimeShortEl) regimeShortEl.textContent = displayShort;
        if (regimeLabelEl) regimeLabelEl.textContent = displayLabel;

        if (regimeSecondaryEl) {
          regimeSecondaryEl.textContent =
            regimeShort
              ? "Regim Coeziv oficial: " + regimeShort
              : "Regim Coeziv calculat în backend pe baza IC_BTC și ICD_BTC.";
        }

        // Construim un text explicativ scurt:
        let explanation = "";
        const contextParts = [];
        if (ctxTrend) contextParts.push(ctxTrend);
        if (ctxVol) contextParts.push(ctxVol);
        if (ctxMacro) contextParts.push(ctxMacro);

        if (contextParts.length > 0) {
          explanation = contextParts.join(" • ");
        } else {
          explanation =
            "Regimul este determinat în backend din indicii IC_BTC structural și ICD_BTC direcțional, " +
            "ținând cont și de volatilitate și context macro.";
        }

        if (regimeExplanationEl) {
          regimeExplanationEl.textContent = explanation;
        }

        // Stil macro (bull / bear / mixed / neutral) derivat din regime_code
        const macroClasses = ["bull", "bear", "mixed", "neutral"];

        let macroClass = "neutral";
        if (regimeCode) {
          const c = String(regimeCode).toLowerCase();
          if (c.includes("bull")) macroClass = "bull";
          else if (c.includes("bear")) macroClass = "bear";
          else if (c.includes("mixed")) macroClass = "mixed";
          else macroClass = "neutral";
        }

        if (regimeDotEl) {
          regimeDotEl.classList.remove(...macroClasses);
          regimeDotEl.classList.add(macroClass);
        }
        if (regimeBannerEl) {
          regimeBannerEl.classList.remove(...macroClasses);
          regimeBannerEl.classList.add(macroClass);

          // opțional: dacă vrei să injectezi culoarea oficială ca accent
          if (regimeColor) {
            regimeBannerEl.style.borderColor = regimeColor;
          }
        }

        // ----- Metrici IC -----
        const icStructValEl = document.getElementById("icStructVal");
        const icDirValEl = document.getElementById("icDirVal");
        const icStructBarEl = document.getElementById("icStructBar");
        const icDirBarEl = document.getElementById("icDirBar");

        if (icStruct != null) {
          if (icStructValEl) icStructValEl.textContent = icStruct.toFixed(0);
          if (icStructBarEl)
            icStructBarEl.style.width = clamp(icStruct, 0, 100) + "%";
        } else {
          if (icStructValEl) icStructValEl.textContent = "–";
          if (icStructBarEl) icStructBarEl.style.width = "0%";
        }

        if (icDir != null) {
          if (icDirValEl) icDirValEl.textContent = icDir.toFixed(0);
          if (icDirBarEl) {
            icDirBarEl.style.width =
              clamp(Math.abs(icDir - 50) * 2, 0, 100) + "%";
            icDirBarEl.classList.remove("bull", "bear", "neutral");
            if (icDir > 55) icDirBarEl.classList.add("bull");
            else if (icDir < 45) icDirBarEl.classList.add("bear");
            else icDirBarEl.classList.add("neutral");
          }
        } else {
          if (icDirValEl) icDirValEl.textContent = "–";
          if (icDirBarEl) {
            icDirBarEl.style.width = "0%";
            icDirBarEl.classList.add("neutral");
          }
        }

        // ----- Context scurt din backend -----
        const trendEl = document.getElementById("contextTrend");
        const volEl = document.getElementById("contextVol");
        const macroEl = document.getElementById("contextMacro");

        if (trendEl) {
          trendEl.textContent = ctxTrend || "Trend: –";
        }
        if (volEl) {
          volEl.textContent = ctxVol || "Volatilitate relativă: –";
        }
        if (macroEl) {
          macroEl.textContent = ctxMacro || "Macro (scurt): –";
        }
      } catch (err) {
        showError(
          "Eroare la încărcarea datelor sau la interpretarea regimului coeziv: " +
            err.message
        );
      }
    }

    main();
  </script>
</body>
</html>
