<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Probabilitate BTC – Modelul Coeziv</title>

<!-- Stil general -->
<style>
    body {
        background: #0e1117;
        color: #e5e5e5;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
    }

    h1, h2 {
        font-weight: 700;
    }

    .card {
        background: #111827;
        border-radius: 18px;
        padding: 20px;
        margin-top: 20px;
        border: 1px solid #1f2937;
    }

    .tag {
        display: inline-block;
        padding: 6px 12px;
        margin: 5px 5px 0 0;
        border-radius: 12px;
        font-size: 0.9rem;
        background: #1f2937;
        border: 1px solid #374151;
    }

    .tag.green { background: #065f46; }
    .tag.red { background: #7f1d1d; }
    .tag.blue { background: #1e3a8a; }

    /* Bara probabilități */
    .bar-container {
        width: 100%;
        height: 26px;
        border-radius: 20px;
        overflow: hidden;
        background: #222;
        margin: 20px 0 10px 0;
        display: flex;
    }

    .bar-up {
        background: #16a34a; /* verde */
        height: 100%;
        transition: width 0.6s ease;
    }

    .bar-down {
        background: #dc2626; /* roșu */
        height: 100%;
        transition: width 0.6s ease;
    }

    /* Regim */
    .regime-box {
        font-size: 1.2rem;
        font-weight: bold;
        color: #facc15;
    }
</style>
</head>

<body>

<h1>PROBABILITATE BTC – MODEL COEZIV</h1>

<div id="status"></div>

<div class="card">
    <h2>Probabilități Coezive BTC</h2>
    <p><strong>Ultima zi:</strong> <span id="last-date">–</span></p>

    <h1 id="p_up">– %</h1>
    <p>Probabilitate continuare trend <strong>UP</strong></p>

    <h1 id="p_down">– %</h1>
    <p>Probabilitate continuare trend <strong>DOWN</strong></p>

    <div class="bar-container">
        <div id="barUp" class="bar-up" style="width: 50%"></div>
        <div id="barDown" class="bar-down" style="width: 50%"></div>
    </div>

    <p>UP: <span id="upVal">–</span>%  
       <span style="float:right;">DOWN: <span id="downVal">–</span>%</span></p>

    <h3>Nivel încredere</h3>
    <p id="conf">–</p>

    <h3>Regim Coeziv BTC</h3>
    <p class="regime-box" id="regim">–</p>
</div>


<script>
async function loadBTC() {
    try {
        const resp = await fetch("btc_state_latest.json");
        const data = await resp.json();

        const { 
            date,
            ic_struct,
            ic_dir,
            ema50_pos,
            ema200_pos,
            vol30,
            macro_score
        } = data;

        document.getElementById("last-date").textContent = date;

        /* -----------------------------
            1. Calcul probabilități
        ------------------------------ */

        const base = (ic_struct * 0.55 + ic_dir * 0.45) / 100;

        const ema_bias =
            ema50_pos > 0 && ema200_pos > 0 ? +0.04 :
            ema50_pos > 0 && ema200_pos < 0 ? +0.015 :
            ema50_pos < 0 && ema200_pos < 0 ? -0.04 :
            -0.015;

        const vol_bias = vol30 > 0.06 ? -0.035 :
                         vol30 < 0.03 ? +0.02 :
                         0;

        const macro_bias = macro_score * 0.10;

        let p_up = base + ema_bias + vol_bias + macro_bias;
        p_up = Math.min(0.97, Math.max(0.03, p_up));
        const p_down = 1 - p_up;

        const upPct = Math.round(p_up * 100);
        const downPct = Math.round(p_down * 100);

        document.getElementById("p_up").textContent = upPct + "%";
        document.getElementById("p_down").textContent = downPct + "%";

        document.getElementById("upVal").textContent = upPct;
        document.getElementById("downVal").textContent = downPct;

        document.getElementById("barUp").style.width = upPct + "%";
        document.getElementById("barDown").style.width = downPct + "%";

        const confidence =
            Math.round(
                (Math.abs(ic_struct - 50) * 0.5 +
                 Math.abs(ic_dir - 50) * 0.3 +
                 Math.abs(macro_score) * 20) / 2
            );

        document.getElementById("conf").textContent = confidence + "%";


        /* -----------------------------
            2. Regim Coeziv
        ------------------------------ */

        let regime = "neclar";

        if (ic_struct > 70 && ic_dir > 55 && ema50_pos > 0 && ema200_pos > 0)
            regime = "Bull structural";
        else if (ic_struct > 70 && ic_dir < 45 && ema50_pos > 0)
            regime = "Top / bull tardiv";
        else if (ic_struct < 40 && ema50_pos < 0 && ema200_pos < 0)
            regime = "Bear structural";
        else if (ic_struct > 55 && Math.abs(ic_dir - 50) < 8)
            regime = "Fază laterală coerentă";
        else
            regime = "Regim mixt / tranziție";

        document.getElementById("regim").textContent = regime;

    } catch (err) {
        document.getElementById("status").textContent =
            "Eroare la citirea datelor: " + err;
    }
}

loadBTC();
</script>

</body>
</html>
